!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).liquidjs={})}(this,function(e){"use strict";var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function t(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var g=function(){return(g=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function y(s,o,a,u){return new(a=a||Promise)(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(s,o||[])).next())})}function m(r,n){var i,s,o,e,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=2&t[0]?s.return:t[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,t[1])).done)return o;switch(s=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],s=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function w(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function r(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e}var i=(s.prototype.valueOf=function(){},s.prototype.liquidMethodMissing=function(e){},s);function s(){}var o=Object.prototype.toString;function b(e){return"[object String]"===o.call(e)}function a(e){return"function"==typeof e}function u(e){return h(e=c(e))?"":String(e)}function c(e){return e instanceof i?e.valueOf():e}function l(e){return"number"==typeof e}function h(e){return null==e}function S(e){return"[object Array]"===o.call(e)}function f(e,t){for(var r in e=e||{})if(e.hasOwnProperty(r)&&!1===t(e[r],r,e))break;return e}function p(e){return e[e.length-1]}function T(e){var t=typeof e;return null!==e&&("object"==t||"function"==t)}function d(e,t,r){void 0===r&&(r=1);for(var n=[],i=e;i<t;i+=r)n.push(i);return n}function x(e,t,r){void 0===r&&(r=" ");for(var n=t-(e=String(e)).length;0<n--;)e=r+e;return e}var k,E=(t(R,k=Error),R.prototype.update=function(){var e=this.originalError,t=function(t){var r=t.input.split("\n"),e=Math.max(t.line-2,1),n=Math.min(t.line+3,r.length);return d(e,n+1).map(function(e){return(e===t.line?">> ":"   ")+x(String(e),String(n).length)+"| "+r[e-1]}).join("\n")}(this.token);this.message=function(e,t){return t.file&&(e+=", file:"+t.file),e+=", line:"+t.line+", col:"+t.col}(e.message,this.token),this.stack=this.message+"\n"+t+"\n"+this.stack+"\nFrom "+e.stack},R);function R(e,t){var r=k.call(this,e.message)||this;return r.originalError=e,r.token=t,r}var q,O=(t(M,q=E),M);function M(e,t){var r=q.call(this,new Error(e),t)||this;return r.name="TokenizationError",q.prototype.update.call(r),r}var L,P=(t(j,L=E),j);function j(e,t){var r=L.call(this,e,t)||this;return r.name="ParseError",r.message=e.message,L.prototype.update.call(r),r}var D,F=(t(U,D=E),U.is=function(e){return e instanceof U},U);function U(e,t){var r=D.call(this,e,t.token)||this;return r.name="RenderError",r.message=e.message,D.prototype.update.call(r),r}var _,A=(t(N,_=Error),N);function N(e){var t=_.call(this,e)||this;return t.name="AssertionError",t.message=e+"",t}function H(e,t){if(!e)throw new A(t=t||"expect "+e+" to be true")}var C={root:["."],cache:!1,extname:"",dynamicPartials:!0,trimTagRight:!1,trimTagLeft:!1,trimOutputRight:!1,trimOutputLeft:!1,greedy:!0,tagDelimiterLeft:"{%",tagDelimiterRight:"%}",outputDelimiterLeft:"{{",outputDelimiterRight:"}}",strictFilters:!1,strictVariables:!1};function z(e){return(e=e||{}).hasOwnProperty("root")&&(e.root=$(e.root)),e}function Y(e){return g({},C,e)}function $(e){return S(e)?e:b(e)?[e]:[]}var I=(V.prototype.getRegister=function(e,t){return void 0===t&&(t={}),this.registers[e]=this.registers[e]||t},V.prototype.setRegister=function(e,t){return this.registers[e]=t},V.prototype.getAll=function(){return v([this.environments],this.scopes).reduce(function(e,t){return g(e,t)},{})},V.prototype.get=function(e){var t,r,n=this.parseProp(e),i=this.findScope(n[0])||this.environments;try{for(var s=w(n),o=s.next();!o.done;o=s.next()){var a=o.value;if(h(i=G(i,a))&&this.opts.strictVariables)throw new TypeError("undefined variable: "+a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i},V.prototype.push=function(e){return this.scopes.push(e)},V.prototype.pop=function(){return this.scopes.pop()},V.prototype.front=function(){return this.scopes[0]},V.prototype.findScope=function(e){for(var t=this.scopes.length-1;0<=t;t--){var r=this.scopes[t];if(e in r)return r}return null},V.prototype.parseProp=function(e){e=String(e);for(var t,r=[],n="",i=0;i<e.length;)switch(e[i]){case"[":o();var s=e[i+1];i=/['"]/.test(s)?(H(-1!==(t=e.indexOf(s,i+2)),"unbalanced "+s+": "+e),n=e.slice(i+2,t),o(),t+2):(H(-1!==(t=W(e,i+1)),"unbalanced []: "+e),n=e.slice(i+1,t),/^[+-]?\d+$/.test(n)||(n=String(this.get(n))),o(),t+1);break;case".":o(),i++;break;default:n+=e[i++]}if(o(),!r.length)throw new TypeError('invalid path:"'+e+'"');return r;function o(){n.length&&r.push(n),n=""}},V);function V(e,t,r){void 0===e&&(e={}),void 0===r&&(r=!1),this.scopes=[{}],this.registers={},this.sync=r,this.opts=Y(t),this.environments=e}function G(e,t){return h(e)?e:(e=function e(t){return t&&a(t.toLiquid)?e(t.toLiquid()):t}(e))instanceof i?a(e[t])?e[t]():e.hasOwnProperty(t)?e[t]:e.liquidMethodMissing(t):"size"===t?function(e){return h(e.size)&&(S(e)||b(e))?e.length:e.size}(e):e[t]}function W(e,t){for(var r=1,n=t;n<e.length;n++)if("["===e[n]&&r++,"]"===e[n]&&0===--r)return n;return-1}var J,B={readFile:function(n){return y(this,void 0,void 0,function(){return m(this,function(e){return[2,new Promise(function(e,t){var r=new XMLHttpRequest;r.onload=function(){200<=r.status&&r.status<300?e(r.responseText):t(new Error(r.statusText))},r.onerror=function(){t(new Error("An error occurred whilst receiving the response."))},r.open("GET",n),r.send()})]})})},resolve:function(e,t,i){return e.length&&"/"!==p(e)&&(e+="/"),function(e,t){var r=document.createElement("base");r.href=e;var n=document.getElementsByTagName("head")[0];n.insertBefore(r,n.firstChild);var i=document.createElement("a");i.href=t;var s=i.href;return n.removeChild(r),s}(e,t).replace(/^(\w+:\/\/[^/]+)(\/[^?]+)/,function(e,t,r){var n=r.split("/").pop();return/\.\w+$/.test(n)?e:t+r+i})},exists:function(){return y(this,void 0,void 0,function(){return m(this,function(e){return[2,!0]})})},existsSync:function(){return!0},readFileSync:function(e){var t=new XMLHttpRequest;if(t.open("GET",e,!1),t.send(),t.status<200||300<=t.status)throw new Error(t.statusText);return t.responseText}},X=function(e,t,r,n,i){this.trimLeft=!1,this.trimRight=!1,this.type="notset",this.col=n,this.line=r,this.raw=e,this.value=e,this.input=t,this.file=i},K=(t(Q,J=X),Q);function Q(e,t,r,n,i,s,o,a){var u=J.call(this,e,r,n,i,a)||this,c="-"===t[0],l="-"===p(t);return u.value=t.slice(c?1:0,l?-1:t.length).trim(),u.trimLeft=c||s,u.trimRight=l||o,u}var Z,ee=new RegExp(/'[^']*'/.source+"|"+/"[^"]*"/.source),te=/[+-]?(?:\d+\.?\d*|\.?\d+)/,re=/[\w-]+[?]?/,ne=new RegExp("\\[(?:"+ee.source+"|[\\w-\\.]+)\\]"),ie=new RegExp("(?:"+ee.source+"|"+/true|false/.source+"|"+te.source+")"),se=new RegExp(re.source+"(?:\\."+re.source+"|"+ne.source+")*"),oe=new RegExp("(?:"+se.source+"|"+te.source+")"),ae=new RegExp("\\("+oe.source+"\\.\\."+oe.source+"\\)"),ue=new RegExp("\\(("+oe.source+")\\.\\.("+oe.source+")\\)"),ce=new RegExp("(?:"+se.source+"|"+ie.source+"|"+ae.source+")"),le=new RegExp("(?:"+re.source+")\\s*:\\s*(?:"+ce.source+")"),he=new RegExp("("+re.source+")\\s*:\\s*("+ce.source+")","g"),fe=new RegExp("^\\s*("+re.source+")\\s*([\\s\\S]*?)\\s*$"),pe=new RegExp("^"+ee.source+"$"),de=new RegExp("^"+ue.source+"$"),ve=(t(ye,Z=K),ye.is=function(e){return"tag"===e.type},ye);function ye(e,t,r,n,i,s,o){var a=Z.call(this,e,t,r,n,i,s.trimTagLeft,s.trimTagRight,o)||this;a.type="tag";var u=a.value.match(fe);if(!u)throw new O("illegal tag syntax",a);return a.name=u[1],a.args=u[2],a}var ge,me=(t(we,ge=X),we.is=function(e){return"html"===e.type},we);function we(e,t,r,n,i){var s=ge.call(this,e,t,r,n,i)||this;return s.type="html",s.value=e,s}function be(e,t){if(e&&me.is(e)){var r=t?/\s+$/g:/[\t\r ]*$/g;e.value=e.value.replace(r,"")}}function Se(e,t){if(e&&me.is(e)){var r=t?/^\s+/g:/^[\t\r ]*\n?/g;e.value=e.value.replace(r,"")}}var Te,xe,ke,Ee=(t(Re,Te=K),Re.is=function(e){return"output"===e.type},Re);function Re(e,t,r,n,i,s,o){var a=Te.call(this,e,t,r,n,i,s.trimOutputLeft,s.trimOutputRight,o)||this;return a.type="output",a}(ke=xe=xe||{})[ke.HTML=0]="HTML",ke[ke.OUTPUT=1]="OUTPUT",ke[ke.TAG=2]="TAG";var qe=(Oe.prototype.tokenize=function(e,t){for(var r=[],n=this.options,i=n.tagDelimiterLeft,s=n.tagDelimiterRight,o=n.outputDelimiterLeft,a=n.outputDelimiterRight,u=0,c=1,l=xe.HTML,h="",f=0,p=1,d=1;u<e.length;){if("\n"===e[u]&&(c++,f=u+1),l===xe.HTML){if(e.substr(u,o.length)===o){h&&r.push(new me(h,e,p,d,t)),p=c,d=u-f+1,u+=(h=o).length,l=xe.OUTPUT;continue}if(e.substr(u,i.length)===i){h&&r.push(new me(h,e,p,d,t)),p=c,d=u-f+1,u+=(h=i).length,l=xe.TAG;continue}}else{if(l===xe.OUTPUT&&e.substr(u,a.length)===a){h+=a,r.push(new Ee(h,h.slice(o.length,-a.length),e,p,d,this.options,t)),h="",p=c,d=(u+=a.length)-f+1,l=xe.HTML;continue}if(e.substr(u,s.length)===s){h+=s,r.push(new ve(h,h.slice(i.length,-s.length),e,p,d,this.options,t)),h="",p=c,d=(u+=s.length)-f+1,l=xe.HTML;continue}}h+=e[u++]}if(l===xe.HTML)return h&&r.push(new me(h,e,p,d,t)),function(e,t){t=g({greedy:!0},t);for(var r=!1,n=0;n<e.length;n++){var i=e[n];!r&&i.trimLeft&&be(e[n-1],t.greedy),ve.is(i)&&("raw"===i.name?r=!0:"endraw"===i.name&&(r=!1)),!r&&i.trimRight&&Se(e[n+1],t.greedy)}}(r,this.options),r;var v=l===xe.OUTPUT?"output":"tag",y=16<h.length?h.slice(0,13)+"...":h;throw new O(v+' "'+y+'" not closed',new X(h,e,p,d,t))},Oe);function Oe(e){this.options=Y(e)}var Me=(Le.prototype.write=function(e){this.html+=e},Le);function Le(){this.html="",this.break=!1,this.continue=!1}var Pe=(je.prototype.renderTemplates=function(c,l,h){return void 0===h&&(h=new Me),y(this,void 0,void 0,function(){var t,r,n,i,s,o,a,u;return m(this,function(e){switch(e.label){case 0:e.trys.push([0,7,8,9]),t=w(c),r=t.next(),e.label=1;case 1:if(r.done)return[3,6];n=r.value,e.label=2;case 2:return e.trys.push([2,4,,5]),[4,n.render(l,h)];case 3:return(i=e.sent())&&h.write(i),h.break||h.continue?[3,6]:[3,5];case 4:throw s=e.sent(),F.is(s)?s:new F(s,n);case 5:return r=t.next(),[3,1];case 6:return[3,9];case 7:return o=e.sent(),a={error:o},[3,9];case 8:try{r&&!r.done&&(u=t.return)&&u.call(t)}finally{if(a)throw a.error}return[7];case 9:return[2,h.html]}})})},je.prototype.renderTemplatesSync=function(e,t,r){var n,i;void 0===r&&(r=new Me);try{for(var s=w(e),o=s.next();!o.done;o=s.next()){var a=o.value;try{var u=a.renderSync(t,r);if(!u||u instanceof Promise||r.write(u),r.break||r.continue)break}catch(e){throw F.is(e)?e:new F(e,a)}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return r.html},je);function je(){}function De(e){this.token=e}var Fe,Ue=(t(_e,Fe=i),_e.prototype.equals=function(e){return b(e)||S(e)?0===e.length:!!T(e)&&0===Object.keys(e).length},_e.prototype.gt=function(){return!1},_e.prototype.geq=function(){return!1},_e.prototype.lt=function(){return!1},_e.prototype.leq=function(){return!1},_e.prototype.valueOf=function(){return""},_e);function _e(){return null!==Fe&&Fe.apply(this,arguments)||this}var Ae,Ne=(t(He,Ae=Ue),He.prototype.equals=function(e){return!1===e||!!h(c(e))||(b(e)?/^\s*$/.test(e):Ae.prototype.equals.call(this,e))},He);function He(){return null!==Ae&&Ae.apply(this,arguments)||this}var Ce,ze=(t(Ye,Ce=i),Ye.prototype.equals=function(e){return h(c(e))||e instanceof Ne},Ye.prototype.gt=function(){return!1},Ye.prototype.geq=function(){return!1},Ye.prototype.lt=function(){return!1},Ye.prototype.leq=function(){return!1},Ye.prototype.valueOf=function(){return null},Ye);function Ye(){return null!==Ce&&Ce.apply(this,arguments)||this}var $e=(Ie.prototype.evaluate=function(t){return y(this,void 0,void 0,function(){return m(this,function(e){return[2,this.evaluateSync(t)]})})},Ie.prototype.evaluateSync=function(e){var t=function(e){return"true"===(e=e.trim())||"false"!==e&&("nil"===e||"null"===e?new ze:"empty"===e?new Ue:"blank"===e?new Ne:isNaN(Number(e))?'"'!==e[0]&&"'"!==e[0]||e[0]!==p(e)?void 0:e.slice(1,-1):Number(e))}(this.str);return void 0!==t?t:e.get(this.str)},Ie.prototype.value=function(r){return y(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return t=c,[4,this.evaluate(r)];case 1:return[2,t.apply(void 0,[e.sent()])]}})})},Ie.prototype.valueSync=function(e){return c(this.evaluateSync(e))},Ie);function Ie(e){this.str=e}function Ve(e){return"("===e[0]&&")"===e[e.length-1]}function Ge(e,t){var r;if(r=e.match(de))return d(+new $e(r[1]).valueSync(t),+new $e(r[2]).valueSync(t)+1)}function We(e){return e&&a(e.equals)}function Je(e){return!Be(e)}function Be(e){return!1===e||null==e}var Xe={"==":1,"!=":1,">":1,"<":1,">=":1,"<=":1,contains:1,and:0,or:0},Ke={"==":function(e,t){return We(e)?e.equals(t):We(t)?t.equals(e):e===t},"!=":function(e,t){return We(e)?!e.equals(t):We(t)?!t.equals(e):e!==t},">":function(e,t){return We(e)?e.gt(t):We(t)?t.lt(e):t<e},"<":function(e,t){return We(e)?e.lt(t):We(t)?t.gt(e):e<t},">=":function(e,t){return We(e)?e.geq(t):We(t)?t.leq(e):t<=e},"<=":function(e,t){return We(e)?e.leq(t):We(t)?t.geq(e):e<=t},contains:function(e,t){return!(!e||!a(e.indexOf))&&-1<e.indexOf(t)},and:function(e,t){return Je(e)&&Je(t)},or:function(e,t){return Je(e)||Je(t)}},Qe=Object.keys(Xe);function Ze(e){return Qe.includes(e)}var et=(tt.prototype.evaluate=function(h){return y(this,void 0,void 0,function(){var t,r,n,i,s,o,a,u,c,l;return m(this,function(e){switch(e.label){case 0:H(h,"unable to evaluate: context not defined"),e.label=1;case 1:e.trys.push([1,9,10,11]),t=w(this.postfix),r=t.next(),e.label=2;case 2:return r.done?[3,8]:Ze(n=r.value)?(this.evaluateOnce(n),[3,7]):[3,3];case 3:return Ve(n)?(s=(i=this.operands).push,[4,function(i,s){return y(this,void 0,void 0,function(){var t,r,n;return m(this,function(e){switch(e.label){case 0:return(t=i.match(de))?[4,new $e(t[1]).value(s)]:[3,3];case 1:return r=e.sent(),[4,new $e(t[2]).value(s)];case 2:return n=e.sent(),[2,d(+r,+n+1)];case 3:return[2]}})})}(n,h)]):[3,5];case 4:return s.apply(i,[e.sent()]),[3,7];case 5:return a=(o=this.operands).push,[4,new $e(n).evaluate(h)];case 6:a.apply(o,[e.sent()]),e.label=7;case 7:return r=t.next(),[3,2];case 8:return[3,11];case 9:return u=e.sent(),c={error:u},[3,11];case 10:try{r&&!r.done&&(l=t.return)&&l.call(t)}finally{if(c)throw c.error}return[7];case 11:return[2,this.operands[0]]}})})},tt.prototype.evaluateSync=function(e){var t,r;H(e,"unable to evaluate: context not defined");try{for(var n=w(this.postfix),i=n.next();!i.done;i=n.next()){var s=i.value;if(Ze(s))this.evaluateOnce(s);else if(Ve(s))this.operands.push(Ge(s,e));else{var o=new $e(s).evaluateSync(e);this.operands.push(o)}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return this.operands[0]},tt.prototype.value=function(r){return y(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return t=c,[4,this.evaluate(r)];case 1:return[2,t.apply(void 0,[e.sent()])]}})})},tt.prototype.valueSync=function(e){return c(this.evaluateSync(e))},tt.prototype.evaluateOnce=function(e){var t=this.operands.pop(),r=this.operands.pop(),n=Ke[e](r,t);this.operands.push(n)},tt);function tt(e){void 0===e&&(e=""),this.operands=[],this.postfix=v(function(t){var r,n,i,s,o,a,u;return m(this,function(e){switch(e.label){case 0:r=[],e.label=1;case 1:e.trys.push([1,10,11,12]),n=w(function(t){var r,n,i,s,o;return m(this,function(e){switch(e.label){case 0:r=t.length,n="",i={'"':'"',"'":"'","[":"]","(":")"},s=0,e.label=1;case 1:if(!(s<r))return[3,8];switch(o=t[s],o){case"[":case'"':case"'":return[3,2];case" ":case"\t":case"\n":return[3,3]}return[3,6];case 2:for(n+=o;s+1<r&&(n+=t[++s],t[s]!==i[o]););return[3,7];case 3:return n?[4,n]:[3,5];case 4:e.sent(),e.label=5;case 5:return n="",[3,7];case 6:n+=o,e.label=7;case 7:return s++,[3,1];case 8:return n?[4,n]:[3,10];case 9:e.sent(),e.label=10;case 10:return[2]}})}(t)),i=n.next(),e.label=2;case 2:if(i.done)return[3,9];if(!Ze(s=i.value))return[3,6];e.label=3;case 3:return r.length&&Xe[r[r.length-1]]>Xe[s]?[4,r.pop()]:[3,5];case 4:return e.sent(),[3,3];case 5:return r.push(s),[3,8];case 6:return[4,s];case 7:e.sent(),e.label=8;case 8:return i=n.next(),[3,2];case 9:return[3,12];case 10:return o=e.sent(),a={error:o},[3,12];case 11:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(a)throw a.error}return[7];case 12:return r.length?[4,r.pop()]:[3,14];case 13:return e.sent(),[3,12];case 14:return[2]}})}(e))}var rt=(nt.prototype.on=function(e,t){return this.handlers[e]=t,this},nt.prototype.trigger=function(e,t){var r=this.handlers[e];return!!r&&(r(t),!0)},nt.prototype.start=function(){var e;for(this.trigger("start");!this.stopRequested&&(e=this.tokens.shift());)if(!(this.trigger("token",e)||ve.is(e)&&this.trigger("tag:"+e.name,e))){var t=this.parseToken(e,this.tokens);this.trigger("template",t)}return this.stopRequested||this.trigger("end"),this},nt.prototype.stop=function(){return this.stopRequested=!0,this},nt);function nt(e,t){this.handlers={},this.stopRequested=!1,this.tokens=e,this.parseToken=t}var it=(st.parse=function(e){var t,r=new st;for(he.lastIndex=0;t=he.exec(e);){var n=t[1],i=t[2];r[n]=i}return r},st.createSync=function(e,t){var r,n,i=st.parse(e);try{for(var s=w(Object.keys(i)),o=s.next();!o.done;o=s.next()){var a=o.value;i[a]=new et(i[a]).evaluateSync(t)}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i},st.create=function(l,h){return y(this,void 0,void 0,function(){var t,r,n,i,s,o,a,u,c;return m(this,function(e){switch(e.label){case 0:t=st.parse(l),e.label=1;case 1:e.trys.push([1,6,7,8]),r=w(Object.keys(t)),n=r.next(),e.label=2;case 2:return n.done?[3,5]:(i=n.value,[4,new et((s=t)[o=i]).evaluate(h)]);case 3:s[o]=e.sent(),e.label=4;case 4:return n=r.next(),[3,2];case 5:return[3,8];case 6:return a=e.sent(),u={error:a},[3,8];case 7:try{n&&!n.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 8:return[2,t]}})})},st);function st(){}var ot,at=(t(ut,ot=De),ut.prototype.renderSync=function(e,t){var r=it.createSync(this.token.args,e),n=this.impl;return a(n.renderSync)?n.renderSync(e,r,t):a(n.render)?n.render(e,r,t):void 0},ut.prototype.render=function(n,i){return y(this,void 0,void 0,function(){var t,r;return m(this,function(e){switch(e.label){case 0:return[4,it.create(this.token.args,n)];case 1:return t=e.sent(),a((r=this.impl).render)?[2,r.render(n,t,i)]:[2]}})})},ut.register=function(e,t){ut.impls[e]=t},ut.clear=function(){ut.impls={}},ut.impls={},ut);function ut(e,t,r){var n=ot.call(this,e)||this;n.name=e.name;var i=ut.impls[e.name];return H(i,"tag "+e.name+" not found"),n.impl=Object.create(i),n.impl.liquid=r,n.impl.parse&&n.impl.parse(e,t),n}var ct=(lt.prototype.render=function(p,d){return y(this,void 0,void 0,function(){var t,r,n,i,s,o,a,u,c,l,h,f;return m(this,function(e){switch(e.label){case 0:t=[],e.label=1;case 1:e.trys.push([1,8,9,10]),r=w(this.args),n=r.next(),e.label=2;case 2:return n.done?[3,7]:ht(i=n.value)?(o=(s=t).push,a=[i[0]],[4,new et(i[1]).evaluate(d)]):[3,4];case 3:return o.apply(s,[a.concat([e.sent()])]),[3,6];case 4:return c=(u=t).push,[4,new et(i).evaluate(d)];case 5:c.apply(u,[e.sent()]),e.label=6;case 6:return n=r.next(),[3,2];case 7:return[3,10];case 8:return l=e.sent(),h={error:l},[3,10];case 9:try{n&&!n.done&&(f=r.return)&&f.call(r)}finally{if(h)throw h.error}return[7];case 10:return[2,this.impl.apply({context:d},v([p],t))]}})})},lt.prototype.renderSync=function(e,t){var r,n,i=[];try{for(var s=w(this.args),o=s.next();!o.done;o=s.next()){var a=o.value;ht(a)?i.push([a[0],new et(a[1]).evaluateSync(t)]):i.push(new et(a).evaluateSync(t))}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return this.impl.apply({context:t},v([e],i))},lt.register=function(e,t){lt.impls[e]=t},lt.clear=function(){lt.impls={}},lt.impls={},lt);function lt(e,t,r){var n=lt.impls[e];if(!n&&r)throw new TypeError("undefined filter: "+e);this.name=e,this.impl=n||function(e){return e},this.args=t}function ht(e){return S(e)}var ft=(pt.prototype.parseFilters=function(e,t){for(var r=t;r<e.length;)if("|"===e[r]){for(var n=++r;r<e.length&&"|"!==e[r];)r++;this.parseFilter(e,n,r)}else r++},pt.prototype.parseFilter=function(e,t,r){for(var n,i,s=e[t],o=[],a=t+1;a<r+1;a++)a===r||","===e[a]?((n||i)&&o.push(n?[n,i]:i),i=n=void 0):":"===e[a]?(n=i,i=void 0):void 0===i&&(i=e[a]);this.filters.push(new ct(s,o,this.strictFilters))},pt.prototype.value=function(a){return y(this,void 0,void 0,function(){var t,r,n,i,s,o;return m(this,function(e){switch(e.label){case 0:return[4,new et(this.initial).evaluate(a)];case 1:t=e.sent(),e.label=2;case 2:e.trys.push([2,7,8,9]),r=w(this.filters),n=r.next(),e.label=3;case 3:return n.done?[3,6]:[4,n.value.render(t,a)];case 4:t=e.sent(),e.label=5;case 5:return n=r.next(),[3,3];case 6:return[3,9];case 7:return i=e.sent(),s={error:i},[3,9];case 8:try{n&&!n.done&&(o=r.return)&&o.call(r)}finally{if(s)throw s.error}return[7];case 9:return[2,t]}})})},pt.prototype.valueSync=function(e){var t,r,n=new et(this.initial).evaluateSync(e);try{for(var i=w(this.filters),s=i.next();!s.done;s=i.next())n=s.value.renderSync(n,e)}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},pt.tokenize=function(e){for(var t=[],r=0;r<e.length;){var n=e[r];if('"'===n||"'"===n){var i=r;for(r+=2;r<e.length&&e[r-1]!==n;++r);t.push(e.slice(i,r))}else if(/\s/.test(n))r++;else if(/[|,:]/.test(n))t.push(e[r++]);else{i=r++;for(var s=void 0;r<e.length&&!/[|,:\s]/.test(s=e[r]);++r)if('"'===s||"'"===s)for(r+=2;r<e.length&&e[r-1]!==s;++r);t.push(e.slice(i,r))}}return t},pt);function pt(e,t){this.filters=[];var r=pt.tokenize(e);this.strictFilters=t,this.initial=r[0],this.parseFilters(r,1)}var dt,vt=(t(yt,dt=De),yt.prototype.renderSync=function(e,t){var r=this.value.valueSync(e);t.write(u(c(r)))},yt.prototype.render=function(r,n){return y(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return[4,this.value.value(r)];case 1:return t=e.sent(),n.write(u(c(t))),[2]}})})},yt);function yt(e,t){var r=dt.call(this,e)||this;return r.value=new ft(e.value,t),r}var gt,mt=(t(wt,gt=De),wt.prototype.renderSync=function(e,t){t.write(this.str)},wt.prototype.render=function(t,r){return y(this,void 0,void 0,function(){return m(this,function(e){return this.renderSync(t,r),[2]})})},wt);function wt(e){var t=gt.call(this,e)||this;return t.str=e.value,t}var bt=(St.prototype.parse=function(e){for(var t,r=[];t=e.shift();)r.push(this.parseToken(t,e));return r},St.prototype.parseToken=function(t,e){try{return ve.is(t)?new at(t,e,this.liquid):Ee.is(t)?new vt(t,this.liquid.options.strictFilters):new mt(t)}catch(e){throw new P(e,t)}},St.prototype.parseStream=function(e){var r=this;return new rt(e,function(e,t){return r.parseToken(e,t)})},St);function St(e){this.liquid=e}var Tt,xt=new RegExp("("+re.source+")\\s*=([^]*)"),kt={parse:function(e){var t=e.args.match(xt);H(t,"illegal token "+e.raw),this.key=t[1],this.value=t[2]},render:function(i){return y(this,void 0,void 0,function(){var t,r,n;return m(this,function(e){switch(e.label){case 0:return t=i.front(),r=this.key,i.sync?(n=this.liquid.evalValueSync(this.value,i),[3,3]):[3,1];case 1:return[4,this.liquid.evalValue(this.value,i)];case 2:n=e.sent(),e.label=3;case 3:return t[r]=n,[2]}})})}},Et=(t(Rt,Tt=i),Rt.prototype.next=function(){this.i++},Rt.prototype.index0=function(){return this.i},Rt.prototype.index=function(){return this.i+1},Rt.prototype.first=function(){return 0===this.i},Rt.prototype.last=function(){return this.i===this.length-1},Rt.prototype.rindex=function(){return this.length-this.i},Rt.prototype.rindex0=function(){return this.length-this.i-1},Rt.prototype.valueOf=function(){return JSON.stringify(this)},Rt);function Rt(e){var t=Tt.call(this)||this;return t.i=0,t.length=e,t}var qt,Ot,Mt=new RegExp("^("+re.source+")\\s+in\\s+("+ce.source+")(?:\\s+"+le.source+")*(?:\\s+(reversed))?(?:\\s+"+le.source+")*$"),Lt={type:"block",parse:function(e,t){var r,n=this,i=Mt.exec(e.args);H(i,"illegal tag: "+e.raw),this.variable=i[1],this.collection=i[2],this.reversed=!!i[3],this.templates=[],this.elseTemplates=[];var s=this.liquid.parser.parseStream(t).on("start",function(){return r=n.templates}).on("tag:else",function(){return r=n.elseTemplates}).on("tag:endfor",function(){return s.stop()}).on("template",function(e){return r.push(e)}).on("end",function(){throw new Error("tag "+e.raw+" not closed")});s.start()},render:function(p,d,v){return y(this,void 0,void 0,function(){var t,r,n,i,s,o,a,u,c,l,h,f;return m(this,function(e){switch(e.label){case 0:return t=this.liquid.renderer,p.sync?(n=new et(this.collection).valueSync(p),[3,3]):[3,1];case 1:return[4,new et(this.collection).value(p)];case 2:n=e.sent(),e.label=3;case 3:return S(r=n)||(b(r)&&0<r.length?r=[r]:T(r)&&(r=Object.keys(r).map(function(e){return[e,r[e]]}))),S(r)&&r.length?[3,7]:p.sync?(t.renderTemplatesSync(this.elseTemplates,p,v),[3,6]):[3,4];case 4:return[4,t.renderTemplates(this.elseTemplates,p,v)];case 5:e.sent(),e.label=6;case 6:return[2];case 7:i=d.offset||0,s=void 0===d.limit?r.length:d.limit,r=r.slice(i,i+s),this.reversed&&r.reverse(),o={forloop:new Et(r.length)},p.push(o),e.label=8;case 8:e.trys.push([8,15,16,17]),a=w(r),u=a.next(),e.label=9;case 9:return u.done?[3,14]:(c=u.value,o[this.variable]=c,p.sync?(t.renderTemplatesSync(this.templates,p,v),[3,12]):[3,10]);case 10:return[4,t.renderTemplates(this.templates,p,v)];case 11:e.sent(),e.label=12;case 12:if(v.break)return v.break=!1,[3,14];v.continue=!1,o.forloop.next(),e.label=13;case 13:return u=a.next(),[3,9];case 14:return[3,17];case 15:return l=e.sent(),h={error:l},[3,17];case 16:try{u&&!u.done&&(f=a.return)&&f.call(a)}finally{if(h)throw h.error}return[7];case 17:return p.pop(),[2]}})})}},Pt=new RegExp("("+re.source+")"),jt={parse:function(e,t){var r=this,n=e.args.match(Pt);H(n,e.args+" not valid identifier"),this.variable=n[1],this.templates=[];var i=this.liquid.parser.parseStream(t);i.on("tag:endcapture",function(){return i.stop()}).on("template",function(e){return r.templates.push(e)}).on("end",function(){throw new Error("tag "+e.raw+" not closed")}),i.start()},render:function(i){return y(this,void 0,void 0,function(){var t,r,n;return m(this,function(e){switch(e.label){case 0:return t=this.liquid.renderer,i.sync?(n=t.renderTemplatesSync(this.templates,i),[3,3]):[3,1];case 1:return[4,t.renderTemplates(this.templates,i)];case 2:n=e.sent(),e.label=3;case 3:return r=n,i.front()[this.variable]=r,[2]}})})}},Dt={parse:function(e,t){var r=this;this.cond=e.args,this.cases=[],this.elseTemplates=[];var n=[],i=this.liquid.parser.parseStream(t).on("tag:when",function(e){r.cases.push({val:e.args,templates:n=[]})}).on("tag:else",function(){return n=r.elseTemplates}).on("tag:endcase",function(){return i.stop()}).on("template",function(e){return n.push(e)}).on("end",function(){throw new Error("tag "+e.raw+" not closed")});i.start()},render:function(o,e,a){return y(this,void 0,void 0,function(){var t,r,n,i,s;return m(this,function(e){switch(e.label){case 0:t=this.liquid.renderer,r=0,e.label=1;case 1:return r<this.cases.length?(n=this.cases[r],[4,new et(n.val).value(o)]):[3,6];case 2:return i=e.sent(),[4,new et(this.cond).value(o)];case 3:return s=e.sent(),i!==s?[3,5]:[4,t.renderTemplates(n.templates,o,a)];case 4:return e.sent(),[2];case 5:return r++,[3,1];case 6:return[4,t.renderTemplates(this.elseTemplates,o,a)];case 7:return e.sent(),[2]}})})},renderSync:function(e,t,r){for(var n=this.liquid.renderer,i=0;i<this.cases.length;i++){var s=this.cases[i];if(new et(s.val).valueSync(e)===new et(this.cond).valueSync(e))return void n.renderTemplatesSync(s.templates,e,r)}n.renderTemplatesSync(this.elseTemplates,e,r)}},Ft={parse:function(e,t){var r=this.liquid.parser.parseStream(t);r.on("token",function(e){"endcomment"===e.name&&r.stop()}).on("end",function(){throw new Error("tag "+e.raw+" not closed")}),r.start()}};(Ot=qt=qt||{})[Ot.OUTPUT=0]="OUTPUT",Ot[Ot.STORE=1]="STORE";var Ut,_t=qt,At=/[^\s,]+/,Nt=new RegExp("with\\s+("+ce.source+")"),Ht={parse:function(e){var t=At.exec(e.args);t&&(this.staticValue=t[0]),(t=ce.exec(e.args))&&(this.value=t[0]),(t=Nt.exec(e.args))&&(this.with=t[1])},renderSync:function(e,t,r){var n;if(e.opts.dynamicPartials)if(pe.exec(this.value)){var i=this.value.slice(1,-1);n=this.liquid.parseAndRenderSync(i,e.getAll(),e.opts)}else n=new et(this.value).valueSync(e);else n=this.staticValue;H(n,"cannot include with empty filename");var s=e.getRegister("blocks"),o=e.getRegister("blockMode");e.setRegister("blocks",{}),e.setRegister("blockMode",_t.OUTPUT),this.with&&(t[n]=new et(this.with).evaluateSync(e));var a=this.liquid.getTemplateSync(n,e.opts);e.push(t),this.liquid.renderer.renderTemplatesSync(a,e,r),e.pop(),e.setRegister("blocks",s),e.setRegister("blockMode",o)},render:function(u,c,l){return y(this,void 0,void 0,function(){var t,r,n,i,s,o,a;return m(this,function(e){switch(e.label){case 0:return u.opts.dynamicPartials?pe.exec(this.value)?(r=this.value.slice(1,-1),[4,this.liquid.parseAndRender(r,u.getAll(),u.opts)]):[3,2]:[3,5];case 1:return t=e.sent(),[3,4];case 2:return[4,new et(this.value).value(u)];case 3:t=e.sent(),e.label=4;case 4:return[3,6];case 5:t=this.staticValue,e.label=6;case 6:return H(t,"cannot include with empty filename"),n=u.getRegister("blocks"),i=u.getRegister("blockMode"),u.setRegister("blocks",{}),u.setRegister("blockMode",_t.OUTPUT),this.with?(s=c,o=t,[4,new et(this.with).evaluate(u)]):[3,8];case 7:s[o]=e.sent(),e.label=8;case 8:return[4,this.liquid.getTemplate(t,u.opts)];case 9:return a=e.sent(),u.push(c),[4,this.liquid.renderer.renderTemplates(a,u,l)];case 10:return e.sent(),u.pop(),u.setRegister("blocks",n),u.setRegister("blockMode",i),[2]}})})}},Ct={parse:function(e){var t=e.args.match(re);H(t,"illegal identifier "+e.args),this.variable=t[0]},render:function(e,t,r){var n=e.environments;l(n[this.variable])||(n[this.variable]=0),r.write(u(--n[this.variable]))}},zt=new RegExp("^(?:("+ce.source+")\\s*:\\s*)?(.*)$"),Yt=new RegExp(ce.source,"g"),$t={parse:function(e){var t=zt.exec(e.args);H(t,"illegal tag: "+e.raw),this.group=new et(t[1]);var r=t[2];for(this.candidates=[];t=Yt.exec(r);)this.candidates.push(t[0]);H(this.candidates.length,"empty candidates: "+e.raw)},render:function(u,e,c){return y(this,void 0,void 0,function(){var t,r,n,i,s,o,a;return m(this,function(e){switch(e.label){case 0:return u.sync?(t=this.group.valueSync(u),[3,3]):[3,1];case 1:return[4,this.group.value(u)];case 2:t=e.sent(),e.label=3;case 3:return r="cycle:"+t+":"+this.candidates.join(","),n=u.getRegister("cycle"),void 0===(i=n[r])&&(i=n[r]=0),s=this.candidates[i],i=(i+1)%this.candidates.length,n[r]=i,u.sync?(a=new et(s).valueSync(u),[3,6]):[3,4];case 4:return[4,new et(s).value(u)];case 5:a=e.sent(),e.label=6;case 6:return o=a,c.write(o),[2]}})})}},It={parse:function(e,t){var r,n=this;this.branches=[],this.elseTemplates=[];var i=this.liquid.parser.parseStream(t).on("start",function(){return n.branches.push({cond:e.args,templates:r=[]})}).on("tag:elsif",function(e){n.branches.push({cond:e.args,templates:r=[]})}).on("tag:else",function(){return r=n.elseTemplates}).on("tag:endif",function(){return i.stop()}).on("template",function(e){return r.push(e)}).on("end",function(){throw new Error("tag "+e.raw+" not closed")});i.start()},render:function(u,e,c){return y(this,void 0,void 0,function(){var t,r,n,i,s,o,a;return m(this,function(e){switch(e.label){case 0:t=this.liquid.renderer,e.label=1;case 1:e.trys.push([1,7,8,9]),r=w(this.branches),n=r.next(),e.label=2;case 2:return n.done?[3,6]:(i=n.value,[4,new et(i.cond).value(u)]);case 3:return Je(e.sent())?[4,t.renderTemplates(i.templates,u,c)]:[3,5];case 4:return e.sent(),[2];case 5:return n=r.next(),[3,2];case 6:return[3,9];case 7:return s=e.sent(),o={error:s},[3,9];case 8:try{n&&!n.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}return[7];case 9:return[4,t.renderTemplates(this.elseTemplates,u,c)];case 10:return e.sent(),[2]}})})},renderSync:function(e,t,r){var n,i,s=this.liquid.renderer;try{for(var o=w(this.branches),a=o.next();!a.done;a=o.next()){var u=a.value;if(Je(new et(u.cond).valueSync(e)))return void s.renderTemplatesSync(u.templates,e,r)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}s.renderTemplatesSync(this.elseTemplates,e,r)}},Vt={parse:function(e){var t=e.args.match(re);H(t,"illegal identifier "+e.args),this.variable=t[0]},render:function(e,t,r){var n=e.environments;l(n[this.variable])||(n[this.variable]=0);var i=n[this.variable];n[this.variable]++,r.write(u(i))}},Gt=/\S+/,Wt={parse:function(e,t){var r=Gt.exec(e.args);r&&(this.staticLayout=r[0]),(r=ce.exec(e.args))&&(this.layout=r[0]),this.tpls=this.liquid.parser.parse(t)},render:function(f,p,d){return y(this,void 0,void 0,function(){var t,r,n,i,s,o,a,u,c,l,h;return m(this,function(e){switch(e.label){case 0:return f.opts.dynamicPartials?f.sync?(n=new et(this.layout).valueSync(f),[3,3]):[3,1]:[3,4];case 1:return[4,new et(this.layout).value(f)];case 2:n=e.sent(),e.label=3;case 3:return r=n,[3,5];case 4:r=this.staticLayout,e.label=5;case 5:return H(t=r,"cannot apply layout with empty filename"),f.setRegister("blockMode",_t.STORE),i=f.getRegister("blocks"),s=this.liquid.renderer,f.sync?(a=s.renderTemplatesSync(this.tpls,f),[3,8]):[3,6];case 6:return[4,s.renderTemplates(this.tpls,f)];case 7:a=e.sent(),e.label=8;case 8:return o=a,void 0===i[""]&&(i[""]=o),f.sync?(c=this.liquid.getTemplateSync(t,f.opts),[3,11]):[3,9];case 9:return[4,this.liquid.getTemplate(t,f.opts)];case 10:c=e.sent(),e.label=11;case 11:return u=c,f.push(p),f.setRegister("blockMode",_t.OUTPUT),f.sync?(h=s.renderTemplatesSync(u,f),[3,14]):[3,12];case 12:return[4,s.renderTemplates(u,f)];case 13:h=e.sent(),e.label=14;case 14:return l=h,f.pop(),d.write(l),[2]}})})}},Jt={parse:function(e,t){var r=this,n=/\w+/.exec(e.args);this.block=n?n[0]:"",this.tpls=[];var i=this.liquid.parser.parseStream(t).on("tag:endblock",function(){return i.stop()}).on("template",function(e){return r.tpls.push(e)}).on("end",function(){throw new Error("tag "+e.raw+" not closed")});i.start()},render:function(a,e,u){return y(this,void 0,void 0,function(){var t,r,n,i,s,o;return m(this,function(e){switch(e.label){case 0:return t=a.getRegister("blocks"),r=t[this.block],n=this.liquid.renderer,void 0===r?[3,1]:(s=r,[3,5]);case 1:return a.sync?(o=n.renderTemplatesSync(this.tpls,a),[3,4]):[3,2];case 2:return[4,n.renderTemplates(this.tpls,a)];case 3:o=e.sent(),e.label=4;case 4:s=o,e.label=5;case 5:return i=s,a.getRegister("blockMode",_t.OUTPUT)===_t.STORE?(t[this.block]=i,[2]):(u.write(i),[2])}})})}},Bt={parse:function(e,t){var r=this;this.tokens=[];var n=this.liquid.parser.parseStream(t);n.on("token",function(e){"endraw"===e.name?n.stop():r.tokens.push(e)}).on("end",function(){throw new Error("tag "+e.raw+" not closed")}),n.start()},render:function(e){return this.tokens.map(function(e){return e.raw}).join("")}},Xt=(t(Kt,Ut=Et),Kt.prototype.row=function(){return Math.floor(this.i/this.cols)+1},Kt.prototype.col0=function(){return this.i%this.cols},Kt.prototype.col=function(){return this.col0()+1},Kt.prototype.col_first=function(){return 0===this.col0()},Kt.prototype.col_last=function(){return this.col()===this.cols},Kt);function Kt(e,t){var r=Ut.call(this,e)||this;return r.length=e,r.cols=t,r}var Qt=new RegExp("^("+re.source+")\\s+in\\s+("+ce.source+")(?:\\s+"+le.source+")*$"),Zt={assign:kt,for:Lt,capture:jt,case:Dt,comment:Ft,include:Ht,decrement:Ct,increment:Vt,cycle:$t,if:It,layout:Wt,block:Jt,raw:Bt,tablerow:{parse:function(e,t){var r,n=this,i=Qt.exec(e.args);H(i,"illegal tag: "+e.raw),this.variable=i[1],this.collection=i[2],this.templates=[];var s=this.liquid.parser.parseStream(t).on("start",function(){return r=n.templates}).on("tag:endtablerow",function(){return s.stop()}).on("template",function(e){return r.push(e)}).on("end",function(){throw new Error("tag "+e.raw+" not closed")});s.start()},render:function(l,h,f){return y(this,void 0,void 0,function(){var t,r,n,i,s,o,a,u,c;return m(this,function(e){switch(e.label){case 0:return l.sync?(r=new et(this.collection).valueSync(l)||[],[3,3]):[3,1];case 1:return[4,new et(this.collection).value(l)];case 2:r=e.sent()||[],e.label=3;case 3:t=r,n=h.offset||0,i=void 0===h.limit?t.length:h.limit,t=t.slice(n,n+i),s=h.cols||t.length,o=this.liquid.renderer,a=new Xt(t.length,s),u={tablerowloop:a},l.push(u),c=0,e.label=4;case 4:return c<t.length?(u[this.variable]=t[c],0===a.col0()&&(1!==a.row()&&f.write("</tr>"),f.write('<tr class="row'+a.row()+'">')),f.write('<td class="col'+a.col()+'">'),l.sync?(o.renderTemplatesSync(this.templates,l,f),[3,7]):[3,5]):[3,9];case 5:return[4,o.renderTemplates(this.templates,l,f)];case 6:e.sent(),e.label=7;case 7:f.write("</td>"),e.label=8;case 8:return c++,a.next(),[3,4];case 9:return t.length&&f.write("</tr>"),l.pop(),[2]}})})}},unless:{parse:function(e,t){var r,n=this;this.templates=[],this.elseTemplates=[];var i=this.liquid.parser.parseStream(t).on("start",function(){r=n.templates,n.cond=e.args}).on("tag:else",function(){return r=n.elseTemplates}).on("tag:endunless",function(){return i.stop()}).on("template",function(e){return r.push(e)}).on("end",function(){throw new Error("tag "+e.raw+" not closed")});i.start()},renderSync:function(r,e,n){return y(this,void 0,void 0,function(){var t;return m(this,function(e){return t=this.liquid.renderer,Be(new et(this.cond).valueSync(r))?t.renderTemplatesSync(this.templates,r,n):t.renderTemplatesSync(this.elseTemplates,r,n),[2]})})},render:function(r,e,n){return y(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return t=this.liquid.renderer,[4,new et(this.cond).value(r)];case 1:return[4,Be(e.sent())];case 2:return e.sent()?t.renderTemplates(this.templates,r,n):t.renderTemplates(this.elseTemplates,r,n),[2]}})})}},break:{render:function(e,t,r){return y(this,void 0,void 0,function(){return m(this,function(e){return r.break=!0,[2]})})}},continue:{render:function(e,t,r){return y(this,void 0,void 0,function(){return m(this,function(e){return r.continue=!0,[2]})})}}},er={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},tr={"&amp;":"&","&lt;":"<","&gt;":">","&#34;":'"',"&#39;":"'"};function rr(e){return u(e).replace(/&|<|>|"|'/g,function(e){return er[e]})}var nr={escape:rr,escape_once:function(e){return rr(function(e){return String(e).replace(/&(amp|lt|gt|#34|#39);/g,function(e){return tr[e]})}(e))},newline_to_br:function(e){return e.replace(/\n/g,"<br />")},strip_html:function(e){return e.replace(/<script.*?<\/script>|<!--.*?-->|<style.*?<\/style>|<.*?>/g,"")}},ir={append:function(e,t){return u(e)+u(t)},prepend:function(e,t){return u(t)+u(e)},capitalize:function(e){return(e=u(e)).charAt(0).toUpperCase()+e.slice(1)},lstrip:function(e){return u(e).replace(/^\s+/,"")},downcase:function(e){return u(e).toLowerCase()},upcase:function(e){return u(e).toUpperCase()},remove:function(e,t){return u(e).split(t).join("")},remove_first:function(e,t){return u(e).replace(t,"")},replace:function(e,t,r){return u(e).split(t).join(r)},replace_first:function(e,t,r){return u(e).replace(t,r)},rstrip:function(e){return u(e).replace(/\s+$/,"")},split:function(e,t){return u(e).split(t)},strip:function(e){return u(e).trim()},strip_newlines:function(e){return u(e).replace(/\n/g,"")},truncate:function(e,t,r){void 0===t&&(t=50);void 0===r&&(r="...");return(e=u(e)).length<=t?e:e.substr(0,t-r.length)+r},truncatewords:function(e,t,r){void 0===t&&(t=15);void 0===r&&(r="...");var n=e.split(/\s+/),i=n.slice(0,t).join(" ");n.length>=t&&(i+=r);return i}};var sr=String.prototype.toLowerCase,or={abs:function(e){return Math.abs(e)},at_least:function(e,t){return Math.max(e,t)},at_most:function(e,t){return Math.min(e,t)},ceil:function(e){return Math.ceil(e)},divided_by:function(e,t){return e/t},floor:function(e){return Math.floor(e)},minus:function(e,t){return e-t},modulo:function(e,t){return e%t},round:function(e,t){void 0===t&&(t=0);var r=Math.pow(10,t);return Math.round(e*r)/r},plus:function(e,t){return Number(e)+Number(t)},sort_natural:function(e,r){return e&&e.sort?void 0===r?v(e).sort(ar):v(e).sort(function(e,t){return ar(e[r],t[r])}):[]},times:function(e,t){return e*t}};function ar(e,t){return t?e?(e=sr.call(e))<(t=sr.call(t))?-1:t<e?1:0:1:-1}var ur={url_decode:function(e){return e.split("+").map(decodeURIComponent).join(" ")},url_encode:function(e){return e.split(" ").map(encodeURIComponent).join("+")}},cr={join:function(e,t){return e.join(void 0===t?" ":t)},last:function(e){return S(e)?p(e):""},first:function(e){return S(e)?e[0]:""},map:function(e,t){return e.map(function(e){return e[t]})},reverse:function(e){return v(e).reverse()},sort:function(e,t){return e.sort(t)},size:function(e){return e&&e.length||0},concat:function(e,t){return Array.prototype.concat.call(e,t)},slice:function(e,t,r){void 0===r&&(r=1);return t=t<0?e.length+t:t,e.slice(t,t+r)},uniq:function(e){var t={};return(e||[]).filter(function(e){return!t.hasOwnProperty(String(e))&&(t[String(e)]=!0)})},where:function(e,t,r){return e.filter(function(e){return void 0===r?Je(e[t]):e[t]===r})}};var lr=["January","February","March","April","May","June","July","August","September","October","November","December"],hr=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],fr=lr.map(vr),pr=hr.map(vr),dr={1:"st",2:"nd",3:"rd",default:"th"};function vr(e){return e.slice(0,3)}var yr={daysInMonth:function(e){return[31,yr.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31]},getDayOfYear:function(e){for(var t=0,r=0;r<e.getMonth();++r)t+=yr.daysInMonth(e)[r];return t+e.getDate()},getWeekOfYear:function(e,t){var r=this.getDayOfYear(e)+(t-e.getDay()),n=7-new Date(e.getFullYear(),0,1).getDay()+t;return x(String(Math.floor((r-n)/7)+1),2,"0")},isLeapYear:function(e){var t=e.getFullYear();return!(0!=(3&t)||!(t%100||t%400==0&&t))},getSuffix:function(e){var t=e.getDate().toString(),r=parseInt(t.slice(-1));return dr[r]||dr.default},century:function(e){return parseInt(e.getFullYear().toString().substring(0,2),10)}},gr={a:function(e){return pr[e.getDay()]},A:function(e){return hr[e.getDay()]},b:function(e){return fr[e.getMonth()]},B:function(e){return lr[e.getMonth()]},c:function(e){return e.toLocaleString()},C:function(e){return yr.century(e)},d:function(e){return x(e.getDate(),2,"0")},e:function(e){return x(e.getDate(),2)},H:function(e){return x(e.getHours(),2,"0")},I:function(e){return x(String(e.getHours()%12||12),2,"0")},j:function(e){return x(yr.getDayOfYear(e),3,"0")},k:function(e){return x(e.getHours(),2)},l:function(e){return x(String(e.getHours()%12||12),2)},L:function(e){return x(e.getMilliseconds(),3,"0")},m:function(e){return x(e.getMonth()+1,2,"0")},M:function(e){return x(e.getMinutes(),2,"0")},p:function(e){return e.getHours()<12?"AM":"PM"},P:function(e){return e.getHours()<12?"am":"pm"},q:function(e){return yr.getSuffix(e)},s:function(e){return Math.round(e.valueOf()/1e3)},S:function(e){return x(e.getSeconds(),2,"0")},u:function(e){return e.getDay()||7},U:function(e){return yr.getWeekOfYear(e,0)},w:function(e){return e.getDay()},W:function(e){return yr.getWeekOfYear(e,1)},x:function(e){return e.toLocaleDateString()},X:function(e){return e.toLocaleTimeString()},y:function(e){return e.getFullYear().toString().substring(2,4)},Y:function(e){return e.getFullYear()},z:function(e){var t=e.getTimezoneOffset()/60*100;return(0<t?"-":"+")+x(String(Math.abs(t)),4,"0")},"%":function(){return"%"}};gr.h=gr.b,gr.N=gr.L;var mr=g({},nr,ir,or,ur,{date:function(e,t){var r=e;return"now"===e?r=new Date:l(e)?r=new Date(1e3*e):b(e)&&(r=/^\d+$/.test(e)?new Date(1e3*+e):new Date(e)),function(e){return e instanceof Date&&!isNaN(e.getTime())}(r)?function(e,t){for(var r="",n=t;;){var i=/%./g,s=i.exec(n);if(!s)return r+n;r+=n.slice(0,i.lastIndex-2),n=n.slice(i.lastIndex);var o=s[0].charAt(1),a=gr[o];r+=a?a(e):"%"+o}}(r,t):e}},{default:function(e,t){return Be(c(e))||""===e?t:e}},cr),wr=(br.prototype.parse=function(e,t){var r=this.tokenizer.tokenize(e,t);return this.parser.parse(r)},br.prototype.render=function(e,t,r){var n=g({},this.options,z(r)),i=new I(t,n);return this.renderer.renderTemplates(e,i)},br.prototype.renderSync=function(e,t,r){var n=g({},this.options,z(r)),i=new I(t,n,!0);return this.renderer.renderTemplatesSync(e,i)},br.prototype.parseAndRender=function(r,n,i){return y(this,void 0,void 0,function(){var t;return m(this,function(e){return t=this.parse(r),[2,this.render(t,n,i)]})})},br.prototype.parseAndRenderSync=function(e,t,r){var n=this.parse(e);return this.renderSync(n,t,r)},br.prototype.getTemplateSync=function(t,e){function r(e){var t=u.respectCache(e,function(){if(s.fs.existsSync(e))return s.parse(s.fs.readFileSync(e),e)});if(t)return{value:t}}var n,i,s=this,o=g({},this.options,z(e)),a=o.root.map(function(e){return s.fs.resolve(e,t,o.extname)}),u=this;try{for(var c=w(a),l=c.next();!l.done;l=c.next()){var h=r(l.value);if("object"==typeof h)return h.value}}catch(e){n={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}throw this.lookupError(t,o.root)},br.prototype.getTemplate=function(p,d){return y(this,void 0,void 0,function(){var t,r,n,i,s,o,a,u,c,l,h,f=this;return m(this,function(e){switch(e.label){case 0:t=g({},this.options,z(d)),r=t.root.map(function(e){return f.fs.resolve(e,p,t.extname)}),n=function(r){var t;return m(this,function(e){switch(e.label){case 0:return[4,i.respectCache(r,function(){return y(f,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return[4,this.fs.exists(r)];case 1:return e.sent()?(t=this.parse,[4,this.fs.readFile(r)]):[2];case 2:return[2,t.apply(this,[e.sent(),r])]}})})})];case 1:return void 0!==(t=e.sent())?[2,{value:t}]:[2]}})},i=this,e.label=1;case 1:e.trys.push([1,6,7,8]),s=w(r),o=s.next(),e.label=2;case 2:return o.done?[3,5]:(a=o.value,[5,n(a)]);case 3:if("object"==typeof(u=e.sent()))return[2,u.value];e.label=4;case 4:return o=s.next(),[3,2];case 5:return[3,8];case 6:return c=e.sent(),l={error:c},[3,8];case 7:try{o&&!o.done&&(h=s.return)&&h.call(s)}finally{if(l)throw l.error}return[7];case 8:throw this.lookupError(p,t.root)}})})},br.prototype.renderFile=function(r,n,i){return y(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return[4,this.getTemplate(r,i)];case 1:return t=e.sent(),[2,this.render(t,n,i)]}})})},br.prototype.renderFileSync=function(e,t,r){var n=z(r),i=this.getTemplateSync(e,n);return this.renderSync(i,t,r)},br.prototype.evalValue=function(t,r){return y(this,void 0,void 0,function(){return m(this,function(e){return[2,new ft(t,this.options.strictFilters).value(r)]})})},br.prototype.evalValueSync=function(e,t){return new ft(e,this.options.strictFilters).valueSync(t)},br.prototype.registerFilter=function(e,t){return ct.register(e,t)},br.prototype.registerTag=function(e,t){return at.register(e,t)},br.prototype.plugin=function(e){return e.call(this,br)},br.prototype.express=function(){var i=this;return function(e,t,r){var n={root:v($(this.root),i.options.root)};i.renderFile(e,t,n).then(function(e){return r(null,e)},r)}},br.prototype.lookupError=function(e,t){var r=new Error("ENOENT");return r.message='ENOENT: Failed to lookup "'+e+'" in "'+t+'"',r.code="ENOENT",r},br.prototype.setCache=function(e,t){return void 0===t?t:this.cache[e]=t},br.prototype.respectCache=function(t,e){var r=this;if(!this.options.cache)return e();if(this.cache[t])return this.cache[t];var n=e();return n instanceof Promise?n.then(function(e){return r.setCache(t,e)}):this.setCache(t,n)},br);function br(e){var r=this;void 0===e&&(e={}),this.cache={},this.options=Y(z(e)),this.parser=new bt(this),this.renderer=new Pe,this.tokenizer=new qe(this.options),this.fs=e.fs||B,f(Zt,function(e,t){return r.registerTag(t,e)}),f(mr,function(e,t){return r.registerFilter(t,e)})}e.AssertionError=A,e.Context=I,e.Drop=i,e.Emitter=Me,e.Expression=et,e.Hash=it,e.Liquid=wr,e.ParseError=P,e.ParseStream=rt,e.TagToken=ve,e.Token=X,e.TokenizationError=O,e.isFalsy=Be,e.isTruthy=Je,Object.defineProperty(e,"__esModule",{value:!0})});
