var T=Array.from;function _(e,r){return Array.prototype.forEach.call(e,r)}function H(e){if(e.tagName.indexOf("-")>0)return!0;var r=e.getAttribute("is");return r&&r.indexOf("-")>0}function p(e){return e?Object.keys(e).filter(r=>r!=="constructor"):[]}function y(e){return T(arguments).forEach((r,t)=>{t&&p(r).forEach(a=>{e[a]=r[a]})}),e}function j(e){for(var r=[],t=e.firstChild;t;t=t.nextSibling)r.push(t);return r}function M(e,r){_(r.attributes,t=>{e.attributes.getNamedItem(t.name)||r.attributes.removeNamedItem(t.name)}),_(e.attributes,t=>{r.getAttribute(t.name)!==t.value&&r.setAttribute(t.name,t.value)}),!H(e)&&e.innerHTML!=r.innerHTML&&S(r,j(e))}function x(e){return e.outerHTML.slice(0,-(e.innerHTML.length+e.tagName.length+4))+"/>"}function L(e){return e.nodeType+":"+(e.nodeType===1?H(e)?x(e):e.outerHTML:e.nodeValue)}function A(e,r,t,a,n,s){var i={},u=new Map,f,h;for(f=n;f<s;f++)h=L(a[f]),i[h]||(i[h]=[]),i[h].push(a[f]);var c={},v={},l;for(f=r;f<t;f++){var m=e[f];h=L(m);var g=i[h],b=!1;g&&(l=g.shift(),l&&(u.set(l,m),b=!0)),!b&&m.nodeType===1&&(m.id&&(v[m.id]=m),c[m.nodeName]||(c[m.nodeName]=[]),c[m.nodeName].push(m))}var o;for(f=n;f<s;f++)if(l=a[f],!u.get(l)){var d=l.id;o=d&&v[d],o&&(M(l,o),u.set(l,o),c[l.nodeName].splice(c[l.nodeName].indexOf(o),1),v[d]=null)}for(f=n;f<s;f++)l=a[f],!u.get(l)&&l.nodeType===1&&(o=(c[l.nodeName]||[]).shift())&&(M(l,o),u.set(l,o));return u}function S(e,r){for(var t=j(e),a=t.length,n=0,s=a,i=r,u=0,f=i.length;n<s||u<f;)if(s===n)for(var h=t[s];u<f;)e.insertBefore(i[u++],h);else if(f===u)if(!i.length)e.replaceChildren(),s=n;else for(;n<s;)t[--s].remove();else if(t[n].isEqualNode(i[u]))n++,u++;else if(t[s-1].isEqualNode(i[f-1]))s--,f--;else if(n<s-1&&u<f-1&&t[n].isEqualNode(i[f-1])&&i[u].isEqualNode(t[s-1])){--s,u++,--f;var c=t[n++],v=t[s],l=c.nextSibling;e.insertBefore(c,v.nextSibling),l!==v&&e.insertBefore(v,l)}else{var m=A(t,n,s,i,u,f),g,b,o;for(g=u;g<f;g++){b=i[g];var d=m.get(b);o=o?o.nextSibling:t[g],d?o!==d&&(e.insertBefore(d,o),o=d):(e.insertBefore(b,o),o=b,a++)}for(;a-- >i.length;)o.nextSibling.remove();break}}function O(e){var r=this;r._data=e||{},r._subscribers=[],Object.defineProperty(this,"data",{configurable:!1,set(t){if(typeof t=="object"){var a=[].concat(p(t).filter(n=>r._data[n]!==t[n]),p(r._data).filter(n=>!(n in t)));r._data=t,r.notify(a)}},get(){return r._data}})}O.prototype={data:{},notify(e){var r=e.reduce((t,a)=>(t[a]=1,t),{});this._subscribers.forEach(t=>{var a=t.props.filter(n=>r[n]);a.length&&t.callback.call(t.context,a)})},subscribe(e,r,t){if(!(typeof r!="function"||!Array.isArray(e))){var a=this,n=a._subscribers.some(s=>s.callback===r&&(t===void 0||t===s.context));n||a._subscribers.push({props:e,callback:r,context:t})}},unsubscribe(e,r){this._subscribers=this._subscribers.filter(t=>!(t.callback===e&&(r===void 0||r===t.context)))},assign(e){var r=this;if(typeof e=="object"){var t=p(e).filter(a=>r._data[a]!==e[a]);y(r._data,e),r.notify(t)}}};var q={"<":"&lt;",">":"&gt;","&":"&amp;","'":"&apos;",'"':"&quot;"};function B(e){return e&&e.replace(/[<>&'"]/g,r=>q[r])}function W(e,...r){return e.reduce((t,a,n)=>{let s=String(r[n-1]);return(e[n-1]||"").endsWith("$")?t=t.slice(0,-1):s=B(s),t+s+a})}function C(e){e=e||{};for(var r=1;r<arguments.length;r++){var t=arguments[r];if(!(!t||typeof i!="object"))for(var a=a(t),n=1;n<a.length;n++){var s=a[n],i=t[s];e[s]=typeof i=="object"&&i!==null?C(e[s],i):i}}return e}function V(e){var r=document.createElement("template");return r.innerHTML=e,r.content}function k(e,r){for(var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),a=t.nextNode();a;){if(H(a)){a=t.nextSibling();continue}r(a),a=t.nextNode()}}function F(e){var r=this;r._data=typeof e.data=="object"&&e.data||{};var t=e.mount,a=e.hydrate;delete e.data,delete e.mount,delete e.hydrate,y(r,e),Object.defineProperty(r,"data",{configurable:!1,set(n){r._data=n,r.render()},get(){return r._data}}),a?r.hydrate():t&&r.mount()}var E=new WeakMap;function I(e,r,t,a){if(a){var n=E.get(e)||{};n[t]=a,E.set(e,n),e.addEventListener(t,r)}}function $(e,r){Object.keys(E.get(e)||{}).forEach(t=>{e.removeEventListener(t,r)}),E.delete(e)}function z(e,r){var t=r.currentTarget,a=(E.get(t)||{})[r.type];a&&a.call(e,r)}F.prototype={_data:null,target:null,stores:null,getHtml(){return""},assign(){var e=T(arguments);y.apply(null,[this.data].concat(e)),this.render()},merge(e){C(this.data,e),this.render()},handleEvent(e){z(this,e)},toString:function(){var r=this,t=r.stores;let a=p(t).reduce((s,i)=>{var{store:u,props:f}=t[i],h=u&&u._data||{};return s[i]=(f||[]).reduce((c,v)=>(c[v]=h[v],c),{}),s},{});var n=y({stores:a},r.data);return r.getHtml(n)},render(){var e=this,r=e.el,t=document.activeElement.id;r&&k(r,i=>{var u=i.getAttribute("ref");u&&e[u]instanceof Node&&delete e[u],E.has(i)&&$(i,e)});var a=V(e.toString()),n=T(a.childNodes);if(r&&S(r,n),t){var s=document.getElementById(t);s&&s.focus()}e.domHydrate()},domHydrate(){var e=this;e.el.pepperInstance=e,k(e.el,r=>{var t=r.getAttribute("ref");t&&(e[t]=r),_(r.attributes,a=>{if(a.name.startsWith("on-")){var n=a.name.replace(/on-/,"");I(r,e,n,e[a.value])}})})},mount(e=!1){var r=this,t=r.stores;t&&p(t).forEach(n=>{let{store:s,props:i}=t[n];s.subscribe(i,r.render,r)});var a=r.target;return typeof a=="string"&&(a=document.querySelector(a)),r.el&&a===r.el?!1:a?(r.el=a,e?r.domHydrate():r.render(),!0):!1},hydrate(e){arguments.length>0&&e&&typeof e=="object"&&(this._data=e),this.mount(!0)},unmount(){var e=this,r=e.stores;r&&p(r).forEach(t=>{r[t].store.unsubscribe(e.render,e)}),e.el.replaceChildren()}};export{F as Pepper,O as Store,W as html};
//# sourceMappingURL=index.min.js.map
