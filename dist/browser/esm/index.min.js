var u=Array.from;function b(t,e){return Array.prototype.forEach.call(t,e)}function y(t){if(t.tagName.indexOf("-")>0)return!0;var e=t.getAttribute("is");return e&&e.indexOf("-")>0}function E(t){return Object.keys(t).filter(e=>e!=="constructor")}function p(t){return u(arguments).forEach((e,r)=>{r&&E(e).forEach(a=>{t[a]=e[a]})}),t}function O(t,e){b(e.attributes,r=>{t.attributes.getNamedItem(r.name)||e.attributes.removeNamedItem(r.name)}),b(t.attributes,r=>{e.getAttribute(r.name)!==r.value&&e.setAttribute(r.name,r.value)})}function C(t){return t.outerHTML.slice(0,-(t.innerHTML.length+t.tagName.length+4))+"/>"}function A(t,e){var r=e.get(t);return r||(r=t.nodeType+":"+(t.nodeType===1?y(t)?C(t):t.outerHTML:t.nodeValue),e.set(t,r)),r}function H(t,e,r,a){if(!t.length){e.forEach(s=>r.removeChild(s));return}var n=new Map,i={};t.forEach(s=>{var h=A(s,n);i[h]=i[h]||{u:[],n2l:new Map},i[h].u.push(s)});var f={};e.forEach(s=>{var h=A(s,n),g=i[h],m=!1;if(g){var l=g.u.shift();l&&(g.n2l.set(l,s),m=!0)}!m&&s.nodeType===1&&(f[s.nodeName]=f[s.nodeName]||[],f[s.nodeName].push(s))});var o=u(r.childNodes).indexOf(a)+1,c=new Set;t.forEach((s,h)=>{var g=A(s,n),m=i[g].n2l.get(s),l=r.childNodes[o+h];if(m){c.add(m),l!==m&&r.insertBefore(m,l);return}var T=s.nodeName;if(s.nodeType===1&&f[T]&&f[T].length){var _=s,d=f[s.nodeName].shift();c.add(d),l!==d&&r.insertBefore(d,l),O(_,d),!y(_)&&_.innerHTML!=d.innerHTML&&H(u(_.childNodes),u(d.childNodes),d);return}c.add(s),r.insertBefore(s,l)}),e.forEach(s=>{c.has(s)||r.removeChild(s)})}function M(t){var e=this;e._data=t||{},e._subscribers=[],Object.defineProperty(this,"data",{configurable:!1,set(r){if(typeof r=="object"){var a=[].concat(E(r).filter(n=>e._data[n]!==r[n]),E(e._data).filter(n=>!(n in r)));e._data=r,e.notify(a)}},get(){return e._data}})}M.prototype={data:{},notify(t){var e=t.reduce((r,a)=>(r[a]=1,r),{});this._subscribers.forEach(r=>{var a=r.props.filter(n=>e[n]);a.length&&r.callback.call(r.context,a)})},subscribe(t,e,r){if(!(typeof e!="function"||!Array.isArray(t))){var a=this,n=a._subscribers.some(i=>i.callback===e&&(r===void 0||r===i.context));n||a._subscribers.push({props:t,callback:e,context:r})}},unsubscribe(t,e){this._subscribers=this._subscribers.filter(r=>!(r.callback===t&&(e===void 0||e===r.context)))},assign(t){var e=this;if(typeof t=="object"){var r=E(t).filter(a=>e._data[a]!==t[a]);p(e._data,t),e.notify(r)}}};var P={"<":"&lt;",">":"&gt;","&":"&amp;","'":"&apos;",'"':"&quot;"};function k(t){return t&&t.replace(/[<>&'"]/g,e=>P[e])}function x(t,...e){return t.reduce((r,a,n)=>{let i=String(e[n-1]);return(t[n-1]||"").endsWith("$")?r=r.slice(0,-1):i=k(i),r+i+a})}function j(t){t=t||{};for(var e=1;e<arguments.length;e++){var r=arguments[e];if(!(!r||typeof f!="object"))for(var a=a(r),n=1;n<a.length;n++){var i=a[n],f=r[i];t[i]=typeof f=="object"&&f!==null?j(t[i],f):f}}return t}function L(t){var e=document.createElement("template");return e.innerHTML=t,e.content}function S(t,e){for(var r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT),a=r.nextNode();a;){if(y(a)){a=r.nextSibling();continue}e(a),a=r.nextNode()}}function W(t){var e=this;e._data=typeof t.data=="object"&&t.data||{};var r=t.mount,a=t.hydrate;delete t.data,delete t.mount,delete t.hydrate,p(e,t),Object.defineProperty(e,"data",{configurable:!1,set(n){e._data=n,e.render()},get(){return e._data}}),a?e.hydrate():r&&e.mount()}var v=new WeakMap;function B(t,e,r,a){if(a){var n=v.get(t)||{};n[r]=a,v.set(t,n),t.addEventListener(r,e)}}function V(t,e){Object.keys(v.get(t)||{}).forEach(function(r){t.removeEventListener(r,e)}),v.delete(t)}function q(t,e){var r=e.currentTarget,a=(v.get(r)||{})[e.type];a&&a.call(t,e)}W.prototype={_data:null,target:null,connect:{},getHtml(){return""},assign(){var t=u(arguments);p.apply(null,[this.data].concat(t)),this.render()},merge(t){j(this.data,t),this.render()},handleEvent(t){q(this,t)},toString:function(){var e=this,r=e.connect,a=r&&r.store&&r.store._data||{},n=(r&&r.props||[]).reduce((f,o)=>(f[o]=a[o],f),{}),i=p(n,e.data);return e.getHtml(i)},render(){var t=this,e=t.el,r=document.activeElement.id;e&&S(e,o=>{var c=o.getAttribute("ref");c&&t[c]instanceof Node&&delete t[c],v.has(o)&&V(o,t)});var a=L(t.toString()),n=u(a.childNodes);if(e){var i=u(e.childNodes);H(n,i,e)}if(r){var f=document.getElementById(r);f&&f.focus()}t.domHydrate()},domHydrate(){var t=this;t.el.pepperInstance=t,S(t.el,e=>{var r=e.getAttribute("ref");r&&(t[r]=e),b(e.attributes,a=>{if(a.name.startsWith("on-")){var n=a.name.replace(/on-/,"");B(e,t,n,t[a.value])}})})},mount(t=!1){var e=this,r=e.connect;r&&r.store&&r.store.subscribe(r.props,e.render,e);var a=e.target;return typeof a=="string"&&(a=document.querySelector(a)),e.el&&a===e.el?!1:a?(e.el=a,t?e.domHydrate():e.render(),!0):!1},hydrate(t){arguments.length>0&&t&&typeof t=="object"&&(this._data=t),this.mount(!0)},unmount(){var t=this,e=t.connect;e&&e.store&&e.store.unsubscribe(t.render,t),t.el.replaceChildren()}};export{W as Pepper,M as Store,x as html};
//# sourceMappingURL=index.min.js.map
