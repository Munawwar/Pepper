var y=Array.from;function H(e,r){return Array.prototype.forEach.call(e,r)}function T(e){if(e.tagName.indexOf("-")>0)return!0;var r=e.getAttribute("is");return r&&r.indexOf("-")>0}function d(e){return e?Object.keys(e).filter(r=>r!=="constructor"):[]}function E(e){return y(arguments).forEach((r,t)=>{t&&d(r).forEach(a=>{e[a]=r[a]})}),e}function M(e,r){H(r.attributes,t=>{e.attributes.getNamedItem(t.name)||r.attributes.removeNamedItem(t.name)}),H(e.attributes,t=>{r.getAttribute(t.name)!==t.value&&r.setAttribute(t.name,t.value)}),!T(e)&&e.innerHTML!=r.innerHTML&&S(r,y(e.childNodes))}function x(e){return e.outerHTML.slice(0,-(e.innerHTML.length+e.tagName.length+4))+"/>"}function A(e){return e.nodeType+":"+(e.nodeType===1?T(e)?x(e):e.outerHTML:e.nodeValue)}function q(e,r,t,a,s,n){var i={},f=new Map,l,h;for(l=s;l<n;l++)h=A(a[l]),i[h]||(i[h]=[]),i[h].push(a[l]);var m={},v={},u;for(l=r;l<t;l++){var o=e[l];h=A(o);var p=i[h],b=!1;p&&(u=p.shift(),u&&(f.set(u,o),b=!0)),!b&&o.nodeType===1&&(o.id&&(v[o.id]=o),m[o.nodeName]||(m[o.nodeName]=[]),m[o.nodeName].push(o))}var c;for(l=s;l<n;l++)if(u=a[l],!f.get(u)){var g=u.id;c=g&&v[g],c&&(M(u,c),f.set(u,c),m[u.nodeName].splice(m[u.nodeName].indexOf(c),1),v[g]=null)}for(l=s;l<n;l++)u=a[l],!f.get(u)&&u.nodeType===1&&(c=(m[u.nodeName]||[]).shift())&&(M(u,c),f.set(u,c));return f}function S(e,r){for(var t=Array.from(e.childNodes),a=0,s=t.length,n=r,i=0,f=n.length;a<s||i<f;)if(s===a)for(var l=e.childNodes[s];i<f;)e.insertBefore(n[i++],l);else if(f===i)if(!n.length)e.replaceChildren(),s=a;else for(;a<s;)t[--s].remove();else if(t[a].isEqualNode(n[i]))a++,i++;else if(t[s-1].isEqualNode(n[f-1]))s--,f--;else if(a<s-1&&i<f-1&&t[a].isEqualNode(n[f-1])&&n[i].isEqualNode(t[s-1])){--s,i++,--f;var h=t[a++],m=t[s],v=h.nextSibling;e.insertBefore(h,m.nextSibling),v!==m&&e.insertBefore(m,v)}else{var u=q(t,a,s,n,i,f),o,p;for(o=i;o<f;o++){p=n[o];var b=u.get(p),c=c?c.nextSibling:t[o];b?c!==b&&e.insertBefore(b,c):e.insertBefore(p,c)}for(var g,k=e.childNodes.length;k-- >n.length;)g||(g=e.childNodes[f].previousSibling),g.nextSibling.remove();break}}function L(e){var r=this;r._data=e||{},r._subscribers=[],Object.defineProperty(this,"data",{configurable:!1,set(t){if(typeof t=="object"){var a=[].concat(d(t).filter(s=>r._data[s]!==t[s]),d(r._data).filter(s=>!(s in t)));r._data=t,r.notify(a)}},get(){return r._data}})}L.prototype={data:{},notify(e){var r=e.reduce((t,a)=>(t[a]=1,t),{});this._subscribers.forEach(t=>{var a=t.props.filter(s=>r[s]);a.length&&t.callback.call(t.context,a)})},subscribe(e,r,t){if(!(typeof r!="function"||!Array.isArray(e))){var a=this,s=a._subscribers.some(n=>n.callback===r&&(t===void 0||t===n.context));s||a._subscribers.push({props:e,callback:r,context:t})}},unsubscribe(e,r){this._subscribers=this._subscribers.filter(t=>!(t.callback===e&&(r===void 0||r===t.context)))},assign(e){var r=this;if(typeof e=="object"){var t=d(e).filter(a=>r._data[a]!==e[a]);E(r._data,e),r.notify(t)}}};var C={"<":"&lt;",">":"&gt;","&":"&amp;","'":"&apos;",'"':"&quot;"};function W(e){return e&&e.replace(/[<>&'"]/g,r=>C[r])}function B(e,...r){return e.reduce((t,a,s)=>{let n=String(r[s-1]);return(e[s-1]||"").endsWith("$")?t=t.slice(0,-1):n=W(n),t+n+a})}function O(e){e=e||{};for(var r=1;r<arguments.length;r++){var t=arguments[r];if(!(!t||typeof i!="object"))for(var a=a(t),s=1;s<a.length;s++){var n=a[s],i=t[n];e[n]=typeof i=="object"&&i!==null?O(e[n],i):i}}return e}function P(e){var r=document.createElement("template");return r.innerHTML=e,r.content}function j(e,r){for(var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),a=t.nextNode();a;){if(T(a)){a=t.nextSibling();continue}r(a),a=t.nextNode()}}function V(e){var r=this;r._data=typeof e.data=="object"&&e.data||{};var t=e.mount,a=e.hydrate;delete e.data,delete e.mount,delete e.hydrate,E(r,e),Object.defineProperty(r,"data",{configurable:!1,set(s){r._data=s,r.render()},get(){return r._data}}),a?r.hydrate():t&&r.mount()}var _=new WeakMap;function F(e,r,t,a){if(a){var s=_.get(e)||{};s[t]=a,_.set(e,s),e.addEventListener(t,r)}}function I(e,r){Object.keys(_.get(e)||{}).forEach(t=>{e.removeEventListener(t,r)}),_.delete(e)}function $(e,r){var t=r.currentTarget,a=(_.get(t)||{})[r.type];a&&a.call(e,r)}V.prototype={_data:null,target:null,stores:null,getHtml(){return""},assign(){var e=y(arguments);E.apply(null,[this.data].concat(e)),this.render()},merge(e){O(this.data,e),this.render()},handleEvent(e){$(this,e)},toString:function(){var r=this,t=r.stores;let a=d(t).reduce((n,i)=>{var{store:f,props:l}=t[i],h=f&&f._data||{};return n[i]=(l||[]).reduce((m,v)=>(m[v]=h[v],m),{}),n},{});var s=E({stores:a},r.data);return r.getHtml(s)},render(){var e=this,r=e.el,t=document.activeElement.id;r&&j(r,i=>{var f=i.getAttribute("ref");f&&e[f]instanceof Node&&delete e[f],_.has(i)&&I(i,e)});var a=P(e.toString()),s=y(a.childNodes);if(r&&S(r,s),t){var n=document.getElementById(t);n&&n.focus()}e.domHydrate()},domHydrate(){var e=this;e.el.pepperInstance=e,j(e.el,r=>{var t=r.getAttribute("ref");t&&(e[t]=r),H(r.attributes,a=>{if(a.name.startsWith("on-")){var s=a.name.replace(/on-/,"");F(r,e,s,e[a.value])}})})},mount(e=!1){var r=this,t=r.stores;t&&d(t).forEach(s=>{let{store:n,props:i}=t[s];n.subscribe(i,r.render,r)});var a=r.target;return typeof a=="string"&&(a=document.querySelector(a)),r.el&&a===r.el?!1:a?(r.el=a,e?r.domHydrate():r.render(),!0):!1},hydrate(e){arguments.length>0&&e&&typeof e=="object"&&(this._data=e),this.mount(!0)},unmount(){var e=this,r=e.stores;r&&d(r).forEach(t=>{r[t].store.unsubscribe(e.render,e)}),e.el.replaceChildren()}};export{V as Pepper,L as Store,B as html};
//# sourceMappingURL=index.min.js.map
