var b=Array.from;function _(e,r){return Array.prototype.forEach.call(e,r)}function H(e){if(e.tagName.indexOf("-")>0)return!0;var r=e.getAttribute("is");return r&&r.indexOf("-")>0}function v(e){return e?Object.keys(e).filter(r=>r!=="constructor"):[]}function y(e){return b(arguments).forEach((r,t)=>{t&&v(r).forEach(a=>{e[a]=r[a]})}),e}function M(e,r){_(r.attributes,t=>{e.attributes.getNamedItem(t.name)||r.attributes.removeNamedItem(t.name)}),_(e.attributes,t=>{r.getAttribute(t.name)!==t.value&&r.setAttribute(t.name,t.value)}),!H(e)&&e.innerHTML!=r.innerHTML&&A(r,b(e.childNodes))}function k(e){return e.outerHTML.slice(0,-(e.innerHTML.length+e.tagName.length+4))+"/>"}function S(e){return e.nodeType+":"+(e.nodeType===1?H(e)?k(e):e.outerHTML:e.nodeValue)}function q(e,r,t,a,n,s){var i={},f=new Map,u,h;for(u=n;u<s;u++)h=S(a[u]),i[h]||(i[h]=[]),i[h].push(a[u]);var c={},d={},l;for(u=r;u<t;u++){var o=e[u];h=S(o);var p=i[h],g=!1;p&&(l=p.shift(),l&&(f.set(l,o),g=!0)),!g&&o.nodeType===1&&(o.id&&(d[o.id]=o),c[o.nodeName]||(c[o.nodeName]=[]),c[o.nodeName].push(o))}var m;for(u=n;u<s;u++)if(l=a[u],!f.get(l)){var T=l.id;m=T&&d[T],m&&(M(l,m),f.set(l,m),c[l.nodeName].splice(c[l.nodeName].indexOf(m),1),d[T]=null)}for(u=n;u<s;u++)l=a[u],!f.get(l)&&l.nodeType===1&&(m=c[l.nodeName]?.shift())&&(M(l,m),f.set(l,m));return f}function A(e,r){for(var t=e.childNodes,a=0,n=t.length,s=r,i=0,f=s.length;a<n||i<f;)if(n===a)for(var u=e.childNodes[n];i<f;)e.insertBefore(s[i++],u);else if(f===i)if(!s.length)e.replaceChildren();else for(;a<n;)t[--n].remove();else if(t[a].isEqualNode(s[i]))a++,i++;else if(t[n-1].isEqualNode(s[f-1]))n--,f--;else if(a<n-1&&i<f-1&&t[a].isEqualNode(s[f-1])&&s[i].isEqualNode(t[n-1])){--n,i++,--f;var h=t[a++],c=t[n],d=h.nextSibling;e.insertBefore(h,c.nextSibling),d!==c&&e.insertBefore(c,d)}else{var l=q(t,a,n,s,i,f),o,p;for(o=i;o<f;o++){p=s[o];var g=l.get(p),m=e.childNodes[o];g?m!==g&&e.insertBefore(g,m):e.insertBefore(p,m)}for(;t.length>s.length;)t[f].remove();break}}function L(e){var r=this;r._data=e||{},r._subscribers=[],Object.defineProperty(this,"data",{configurable:!1,set(t){if(typeof t=="object"){var a=[].concat(v(t).filter(n=>r._data[n]!==t[n]),v(r._data).filter(n=>!(n in t)));r._data=t,r.notify(a)}},get(){return r._data}})}L.prototype={data:{},notify(e){var r=e.reduce((t,a)=>(t[a]=1,t),{});this._subscribers.forEach(t=>{var a=t.props.filter(n=>r[n]);a.length&&t.callback.call(t.context,a)})},subscribe(e,r,t){if(!(typeof r!="function"||!Array.isArray(e))){var a=this,n=a._subscribers.some(s=>s.callback===r&&(t===void 0||t===s.context));n||a._subscribers.push({props:e,callback:r,context:t})}},unsubscribe(e,r){this._subscribers=this._subscribers.filter(t=>!(t.callback===e&&(r===void 0||r===t.context)))},assign(e){var r=this;if(typeof e=="object"){var t=v(e).filter(a=>r._data[a]!==e[a]);y(r._data,e),r.notify(t)}}};var B={"<":"&lt;",">":"&gt;","&":"&amp;","'":"&apos;",'"':"&quot;"};function C(e){return e&&e.replace(/[<>&'"]/g,r=>B[r])}function W(e,...r){return e.reduce((t,a,n)=>{let s=String(r[n-1]);return(e[n-1]||"").endsWith("$")?t=t.slice(0,-1):s=C(s),t+s+a})}function O(e){e=e||{};for(var r=1;r<arguments.length;r++){var t=arguments[r];if(!(!t||typeof i!="object"))for(var a=a(t),n=1;n<a.length;n++){var s=a[n],i=t[s];e[s]=typeof i=="object"&&i!==null?O(e[s],i):i}}return e}function x(e){var r=document.createElement("template");return r.innerHTML=e,r.content}function j(e,r){for(var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),a=t.nextNode();a;){if(H(a)){a=t.nextSibling();continue}r(a),a=t.nextNode()}}function P(e){var r=this;r._data=typeof e.data=="object"&&e.data||{};var t=e.mount,a=e.hydrate;delete e.data,delete e.mount,delete e.hydrate,y(r,e),Object.defineProperty(r,"data",{configurable:!1,set(n){r._data=n,r.render()},get(){return r._data}}),a?r.hydrate():t&&r.mount()}var E=new WeakMap;function V(e,r,t,a){if(a){var n=E.get(e)||{};n[t]=a,E.set(e,n),e.addEventListener(t,r)}}function F(e,r){Object.keys(E.get(e)||{}).forEach(function(t){e.removeEventListener(t,r)}),E.delete(e)}function I(e,r){var t=r.currentTarget,a=(E.get(t)||{})[r.type];a&&a.call(e,r)}P.prototype={_data:null,target:null,stores:null,getHtml(){return""},assign(){var e=b(arguments);y.apply(null,[this.data].concat(e)),this.render()},merge(e){O(this.data,e),this.render()},handleEvent(e){I(this,e)},toString:function(){var r=this,t=r.stores;let a=v(t).reduce((s,i)=>{var{store:f,props:u}=t[i],h=f&&f._data||{};return s[i]=(u||[]).reduce((c,d)=>(c[d]=h[d],c),{}),s},{});var n=y({stores:a},r.data);return r.getHtml(n)},render(){var e=this,r=e.el,t=document.activeElement.id;r&&j(r,i=>{var f=i.getAttribute("ref");f&&e[f]instanceof Node&&delete e[f],E.has(i)&&F(i,e)});var a=x(e.toString()),n=b(a.childNodes);if(r&&A(r,n),t){var s=document.getElementById(t);s&&s.focus()}e.domHydrate()},domHydrate(){var e=this;e.el.pepperInstance=e,j(e.el,r=>{var t=r.getAttribute("ref");t&&(e[t]=r),_(r.attributes,a=>{if(a.name.startsWith("on-")){var n=a.name.replace(/on-/,"");V(r,e,n,e[a.value])}})})},mount(e=!1){var r=this,t=r.stores;t&&v(t).forEach(n=>{let{store:s,props:i}=t[n];s.subscribe(i,r.render,r)});var a=r.target;return typeof a=="string"&&(a=document.querySelector(a)),r.el&&a===r.el?!1:a?(r.el=a,e?r.domHydrate():r.render(),!0):!1},hydrate(e){arguments.length>0&&e&&typeof e=="object"&&(this._data=e),this.mount(!0)},unmount(){var e=this,r=e.stores;r&&v(r).forEach(t=>{r[t].store.unsubscribe(e.render,e)}),e.el.replaceChildren()}};export{P as Pepper,L as Store,W as html};
//# sourceMappingURL=index.min.js.map
