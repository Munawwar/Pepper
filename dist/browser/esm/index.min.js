var g=Array.from;function E(e,t){return Array.prototype.forEach.call(e,t)}function _(e){if(e.tagName.indexOf("-")>0)return!0;var t=e.getAttribute("is");return t&&t.indexOf("-")>0}function H(e){return Object.keys(e).filter(t=>t!=="constructor")}function b(e){return g(arguments).forEach((t,r)=>{r&&H(t).forEach(a=>{e[a]=t[a]})}),e}function M(e,t){E(t.attributes,r=>{e.attributes.getNamedItem(r.name)||t.attributes.removeNamedItem(r.name)}),E(e.attributes,r=>{t.getAttribute(r.name)!==r.value&&t.setAttribute(r.name,r.value)}),!_(e)&&e.innerHTML!=t.innerHTML&&A(t,g(e.childNodes))}function k(e){return e.outerHTML.slice(0,-(e.innerHTML.length+e.tagName.length+4))+"/>"}function S(e){return e.nodeType+":"+(e.nodeType===1?_(e)?k(e):e.outerHTML:e.nodeValue)}function q(e,t,r,a,n,i){var s={},f=new Map,o,h;for(o=n;o<i;o++)h=S(a[o]),s[h]||(s[h]=[]),s[h].push(a[o]);var m={},d={},u;for(o=t;o<r;o++){var l=e[o];h=S(l);var v=s[h],p=!1;v&&(u=v.shift(),u&&(f.set(u,l),p=!0)),!p&&l.nodeType===1&&(l.id&&(d[l.id]=l),m[l.nodeName]||(m[l.nodeName]=[]),m[l.nodeName].push(l))}var c;for(o=n;o<i;o++)if(u=a[o],!f.get(u)){var T=u.id;c=T&&d[T],c&&(M(u,c),f.set(u,c),m[u.nodeName].splice(m[u.nodeName].indexOf(c),1),d[T]=null)}for(o=n;o<i;o++)u=a[o],!f.get(u)&&u.nodeType===1&&(c=m[u.nodeName]?.shift())&&(M(u,c),f.set(u,c));return f}function A(e,t){for(var r=e.childNodes,a=0,n=r.length,i=t,s=0,f=i.length;a<n||s<f;)if(n===a)for(var o=e.childNodes[n];s<f;)e.insertBefore(i[s++],o);else if(f===s)if(!i.length)e.replaceChildren();else for(;a<n;)r[--n].remove();else if(r[a].isEqualNode(i[s]))a++,s++;else if(r[n-1].isEqualNode(i[f-1]))n--,f--;else if(a<n-1&&s<f-1&&r[a].isEqualNode(i[f-1])&&i[s].isEqualNode(r[n-1])){--n,s++,--f;var h=r[a++],m=r[n],d=h.nextSibling;e.insertBefore(h,m.nextSibling),d!==m&&e.insertBefore(m,d)}else{var u=q(r,a,n,i,s,f),l,v;for(l=s;l<f;l++){v=i[l];var p=u.get(v),c=e.childNodes[l];p?c!==p&&e.insertBefore(p,c):e.insertBefore(v,c)}for(;r.length>i.length;)r[f].remove();break}}function j(e){var t=this;t._data=e||{},t._subscribers=[],Object.defineProperty(this,"data",{configurable:!1,set(r){if(typeof r=="object"){var a=[].concat(H(r).filter(n=>t._data[n]!==r[n]),H(t._data).filter(n=>!(n in r)));t._data=r,t.notify(a)}},get(){return t._data}})}j.prototype={data:{},notify(e){var t=e.reduce((r,a)=>(r[a]=1,r),{});this._subscribers.forEach(r=>{var a=r.props.filter(n=>t[n]);a.length&&r.callback.call(r.context,a)})},subscribe(e,t,r){if(!(typeof t!="function"||!Array.isArray(e))){var a=this,n=a._subscribers.some(i=>i.callback===t&&(r===void 0||r===i.context));n||a._subscribers.push({props:e,callback:t,context:r})}},unsubscribe(e,t){this._subscribers=this._subscribers.filter(r=>!(r.callback===e&&(t===void 0||t===r.context)))},assign(e){var t=this;if(typeof e=="object"){var r=H(e).filter(a=>t._data[a]!==e[a]);b(t._data,e),t.notify(r)}}};var B={"<":"&lt;",">":"&gt;","&":"&amp;","'":"&apos;",'"':"&quot;"};function C(e){return e&&e.replace(/[<>&'"]/g,t=>B[t])}function W(e,...t){return e.reduce((r,a,n)=>{let i=String(t[n-1]);return(e[n-1]||"").endsWith("$")?r=r.slice(0,-1):i=C(i),r+i+a})}function O(e){e=e||{};for(var t=1;t<arguments.length;t++){var r=arguments[t];if(!(!r||typeof s!="object"))for(var a=a(r),n=1;n<a.length;n++){var i=a[n],s=r[i];e[i]=typeof s=="object"&&s!==null?O(e[i],s):s}}return e}function x(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function L(e,t){for(var r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),a=r.nextNode();a;){if(_(a)){a=r.nextSibling();continue}t(a),a=r.nextNode()}}function P(e){var t=this;t._data=typeof e.data=="object"&&e.data||{};var r=e.mount,a=e.hydrate;delete e.data,delete e.mount,delete e.hydrate,b(t,e),Object.defineProperty(t,"data",{configurable:!1,set(n){t._data=n,t.render()},get(){return t._data}}),a?t.hydrate():r&&t.mount()}var y=new WeakMap;function V(e,t,r,a){if(a){var n=y.get(e)||{};n[r]=a,y.set(e,n),e.addEventListener(r,t)}}function F(e,t){Object.keys(y.get(e)||{}).forEach(function(r){e.removeEventListener(r,t)}),y.delete(e)}function I(e,t){var r=t.currentTarget,a=(y.get(r)||{})[t.type];a&&a.call(e,t)}P.prototype={_data:null,target:null,connect:{},getHtml(){return""},assign(){var e=g(arguments);b.apply(null,[this.data].concat(e)),this.render()},merge(e){O(this.data,e),this.render()},handleEvent(e){I(this,e)},toString:function(){var t=this,r=t.connect,a=r&&r.store&&r.store._data||{},n=(r&&r.props||[]).reduce((s,f)=>(s[f]=a[f],s),{}),i=b(n,t.data);return t.getHtml(i)},render(){var e=this,t=e.el,r=document.activeElement.id;t&&L(t,s=>{var f=s.getAttribute("ref");f&&e[f]instanceof Node&&delete e[f],y.has(s)&&F(s,e)});var a=x(e.toString()),n=g(a.childNodes);if(t&&A(t,n),r){var i=document.getElementById(r);i&&i.focus()}e.domHydrate()},domHydrate(){var e=this;e.el.pepperInstance=e,L(e.el,t=>{var r=t.getAttribute("ref");r&&(e[r]=t),E(t.attributes,a=>{if(a.name.startsWith("on-")){var n=a.name.replace(/on-/,"");V(t,e,n,e[a.value])}})})},mount(e=!1){var t=this,r=t.connect;r&&r.store&&r.store.subscribe(r.props,t.render,t);var a=t.target;return typeof a=="string"&&(a=document.querySelector(a)),t.el&&a===t.el?!1:a?(t.el=a,e?t.domHydrate():t.render(),!0):!1},hydrate(e){arguments.length>0&&e&&typeof e=="object"&&(this._data=e),this.mount(!0)},unmount(){var e=this,t=e.connect;t&&t.store&&t.store.unsubscribe(e.render,e),e.el.replaceChildren()}};export{P as Pepper,j as Store,W as html};
//# sourceMappingURL=index.min.js.map
