window.Pepper=function(){const t=new WeakMap;var e={merge:function(t){t=t||{};for(var n=1;n<arguments.length;n+=1){var r=arguments[n];if(r&&"object"==typeof s)for(var i=Object.keys(r),o=1;o<i.length;o+=1){var c=i[o],s=r[c];t[c]="object"==typeof s&&null!==s?e.merge(t[c],s):s}}return t},uuid:function(t=11){return"x".repeat(t).replace(/x/g,(function(){return(36*Math.random()|0).toString(36)}))},getUID:function(n,r=!0){var i=t.get(n);return!i&&r&&(i=e.uuid(),t.set(n,i)),i},dom:function(t){if("content"in document.createElement("template")){var e=document.createElement("template");return e.innerHTML=t,e.content}if(window.jQuery){var n=document.createDocumentFragment();return jQuery.parseHTML(t).forEach((function(t){n.appendChild(t)})),n}return window.parseHTML(t)},on:function(t,n,r,i){t._bindings=t._bindings||{},t._bindings[r]=i,e.getUID(i),t.addEventListener(r,n)},off:function(t,e){t._bindings&&(Object.keys(t._bindings).forEach((function(n){t.removeEventListener(n,e)})),delete t._bindings)}},n=function(t){this.id=n.generateUId(),this._data={};var e=t.data;e&&"object"==typeof e&&(this._data=e);var r=t.mount,i=t.hydrate;delete t.data,delete t.mount,delete t.hydrate,Object.assign(this,t),Object.defineProperty(this,"data",{configurable:!1,set:function(t){this._data=t,this.render()},get:function(){return this._data}}),i?this.hydrate():r&&this.mount()};return Object.assign(n,{uid:1,utils:e,generateUId:function(){var t="view-"+n.uid;return n.uid+=1,t},getHtml:function(){return""},store:{_data:{},subscribers:[],subscribe:function(t,e,n){"function"==typeof t&&Array.isArray(e)&&(this.subscribers.some((function(e){return e.callback===t&&(void 0===n||n===e.context)}))||this.subscribers.push({callback:t,props:e,context:n}))},unsubscribe:function(t,e){this.subscribers=this.subscribers.filter((function(n){return!(n.callback===t&&(void 0===e||e===n.context))}))},assign:function(t){if("object"==typeof t){var e=this._data,n=Object.keys(t).filter((function(n){return e[n]!==t[n]}));Object.assign(this._data,t),this.notify(n)}},notify:function(t){var e=t.reduce((function(t,e){return t[e]=1,t}),{});this.subscribers.forEach((function(t){t.props.some((function(t){return"string"==typeof t&&e[t]}))&&t.callback.call(t.context)}))}}}),Object.defineProperty(n.store,"data",{configurable:!1,set:function(t){if("object"==typeof t){var e=this._data,n=Object.keys(t).filter((function(n){return e[n]!==t[n]}));this._data=t,this.notify(n)}},get:function(){return this._data}}),Object.assign(n.prototype,{_data:null,target:null,connect:null,assign:function(){var t=Array.prototype.slice.call(arguments);Object.assign.apply(Object,[this.data].concat(t)),this.render()},merge:function(t){e.merge(this.data,t),this.render()},handleEvent:function(t){var n=this;const r=t.currentTarget._bindings[t.type];e.getUID(r,!1)&&r.call(n,t)},render:function(){var t=this.el,r=document.activeElement.id;t&&[t].concat(Array.from(t.querySelectorAll("*"))).forEach((function(t){1===t.nodeType&&e.off(t,this)}),this);var i=n.store._data,o=(this.connect||[]).reduce((function(t,e){return t[e]=i[e],t}),{}),c=Object.assign(o,this.data),s=e.dom(this.getHtml(c)).firstElementChild;if(t){var a=t.parentNode,u=Array.from(a.childNodes).indexOf(t);window.udomdiff(a,[t],[s],(function(t){return t}),t.nextSibling),this.el=a.childNodes[u]}else this.el=s;if(r){var f=document.getElementById(r);f&&f.focus()}this.domHydrate()},domHydrate:function(){var t=this;t.el.PepperInstance=t,Array.from(t.el.querySelectorAll("[ref]")).forEach((function(e){t[e.getAttribute("ref")]=e}));var n=Array.from(t.el.querySelectorAll("[refs]"));n.forEach((function(e){t[e.getAttribute("ref")]=[]})),n.forEach((function(e){t[e.getAttribute("ref")].push(e)})),[t.el].concat(Array.from(t.el.querySelectorAll("*"))).forEach((function(n){1===n.nodeType&&Array.from(n.attributes).forEach((function(r){if(r.name.startsWith("on-")){var i=r.name.replace(/on-/,"");e.on(n,t,i,t[r.value])}}))}))},mount:function(t=!1){this.connect&&n.store.subscribe(this.render,this.connect,this);var e=this.target;"string"==typeof e&&(e=document.querySelector(e)),this.el&&e===this.el||e&&e.parentNode&&(this.el=e,t?this.domHydrate():this.render())},hydrate:function(t){arguments.length>0&&t&&"object"==typeof t&&(this._data=t),this.mount(!0)},append:function(t){this.connect&&n.store.subscribe(this.render,this.connect,this),this.el||this.render(),t.appendChild(this.el)},unmount:function(){n.store.unsubscribe(this.render,this.connect),this.el.parentNode.removeChild(this.el)}}),n}();