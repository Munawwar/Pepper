!function(e){"object"==typeof module&&module.exports?module.exports=e():window.Pepper=e()}((function(){var e=Array.prototype;function t(t,n){return e.slice.call(t,n)}function n(t,n,r){return e.forEach.call(t,n,r)}function r(e){return t(arguments,1).forEach((function(t){Object.keys(t).forEach((function(n){e[n]=t[n]}))})),e}function i(e){e=e||{};for(var t=1;t<arguments.length;t+=1){var n=arguments[t];if(n&&"object"==typeof c)for(var r=Object.keys(n),o=1;o<r.length;o+=1){var a=r[o],c=n[a];e[a]="object"==typeof c&&null!==c?i(e[a],c):c}}return e}function o(e){if(e.tagName.indexOf("-")>0)return!0;var t=e.getAttribute("is");return t&&t.indexOf("-")>0}function a(e,t){var r,i,a=t.get(e);return a||(a=e.nodeType+":"+(1===e.nodeType?o(e)?(i=["<",(r=e).nodeName],n(r.attributes,(function(e){i.push(" ",e.name,"=",JSON.stringify(e.value))})),i.push("/>"),i.join("")):e.outerHTML:e.nodeValue),t.set(e,a)),a}function c(e,r,i,s,u){if(e.length){var f=new WeakMap,l={};e.forEach((function(e){var t=a(e,f);l[t]=l[t]||{u:[],n2l:new Map,l2n:new Map},l[t].u.push(e)}));var d=0,h={};if(r.forEach((function(e){var t=a(e,f),n=l[t],r=!1;if(n){var i=n.u.shift();i&&(n.n2l.set(i,e),n.l2n.set(e,i),r=!0,d++)}r||1!==e.nodeType||(h[e.nodeName]=h[e.nodeName]||[],h[e.nodeName].push(e))})),d===e.length&&r.length>e.length)for(var p=r.length-1;p>=0;p--){var b=r[p],m=a(b,f);l[m]&&l[m].l2n.has(b)||(i.removeChild(b),r.splice(p,1))}var v=t(i.childNodes).indexOf(s)+1;e.forEach((function(e,t){var r=a(e,f),s=l[r].n2l.get(e),u=i.childNodes[v+t];if(s)u!==s&&i.insertBefore(s,u);else{var d=e.nodeName;if(1===e.nodeType&&h[d]&&h[d].length){var p=e,b=h[e.nodeName].shift();u!==b&&i.insertBefore(b,u),function(e,t){n(t.attributes,(function(n){e.attributes.getNamedItem(n.name)||t.attributes.removeNamedItem(n.name)})),n(e.attributes,(function(e){t.getAttribute(e.name)!==e.value&&t.setAttribute(e.name,e.value)}))}(p,b),o(p)||c(Array.from(p.childNodes),Array.from(b.childNodes),b)}else i.insertBefore(e,u)}}));for(var y=i.childNodes[v+e.length-1];y.nextSibling&&y.nextSibling!==u;)y.parentNode.removeChild(y.nextSibling)}else r.forEach((e=>i.removeChild(e)))}var s=function(e){this.id=s.generateUId(),this._data={};var t=e.data;t&&"object"==typeof t&&(this._data=t);var n=e.mount,i=e.hydrate;delete e.data,delete e.mount,delete e.hydrate,r(this,e),Object.defineProperty(this,"data",{configurable:!1,set:function(e){this._data=e,this.render()},get:function(){return this._data}}),i?this.hydrate():n&&this.mount()},u=new WeakMap;return r(s,{uid:1,generateUId:function(){var e="view-"+s.uid;return s.uid+=1,e},getHtml:function(){return""},store:{_data:{},subscribers:[],subscribe:function(e,t,n){"function"==typeof e&&Array.isArray(t)&&(this.subscribers.some((function(t){return t.callback===e&&(void 0===n||n===t.context)}))||this.subscribers.push({callback:e,props:t,context:n}))},unsubscribe:function(e,t){this.subscribers=this.subscribers.filter((function(n){return!(n.callback===e&&(void 0===t||t===n.context))}))},assign:function(e){if("object"==typeof e){var t=this._data,n=Object.keys(e).filter((function(n){return t[n]!==e[n]}));r(this._data,e),this.notify(n)}},notify:function(e){var t=e.reduce((function(e,t){return e[t]=1,e}),{});this.subscribers.forEach((function(e){e.props.some((function(e){return"string"==typeof e&&t[e]}))&&e.callback.call(e.context)}))}}}),Object.defineProperty(s.store,"data",{configurable:!1,set:function(e){if("object"==typeof e){var t=this._data,n=Object.keys(e).filter((function(n){return t[n]!==e[n]}));this._data=e,this.notify(n)}},get:function(){return this._data}}),r(s.prototype,{_data:null,target:null,connect:null,assign:function(){var e=t(arguments);r.apply(null,[this.data].concat(e)),this.render()},merge:function(e){i(this.data,e),this.render()},handleEvent:function(e){!function(e,t){var n=t.currentTarget,r=(u.get(n)||{})[t.type];r&&r.call(e,t)}(this,e)},render:function(){var e=this.el,n=document.activeElement.id;e&&[e].concat(t(e.querySelectorAll("*"))).forEach((function(e){1===e.nodeType&&function(e,t){Object.keys(u.get(e)||{}).forEach((function(n){e.removeEventListener(n,t)})),u.delete(e)}(e,this)}),this);var i=s.store._data,o=r((this.connect||[]).reduce((function(e,t){return e[t]=i[t],e}),{}),this.data),a=function(e){var t;if("content"in document.createElement("template")){var n=document.createElement("template");n.innerHTML=e,t=n.content}else window.jQuery?(t=document.createDocumentFragment(),jQuery.parseHTML(e).forEach((function(e){t.appendChild(e)}))):t=window.parseHTML(e);for(var r=t.querySelectorAll("script"),i=0;i<r.length;i+=1)t.removeChild(r[i]);return t}(this.getHtml(o)).firstElementChild;if(e){var f=e.parentNode,l=t(f.childNodes).indexOf(e);c([a],[e],f,e.previousSibling,e.nextSibling),this.el=f.childNodes[l]}else this.el=a;if(n){var d=document.getElementById(n);d&&d.focus()}this.domHydrate()},domHydrate:function(){var e=this;e.el.pepperInstance=e,n(e.el.querySelectorAll("[ref]"),(function(t){e[t.getAttribute("ref")]=t}));var r=t(e.el.querySelectorAll("[refs]"));r.forEach((function(t){e[t.getAttribute("ref")]=[]})),r.forEach((function(t){e[t.getAttribute("ref")].push(t)})),[e.el].concat(t(e.el.querySelectorAll("*"))).forEach((function(t){1===t.nodeType&&n(t.attributes,(function(n){if(n.name.startsWith("on-")){var r=n.name.replace(/on-/,"");!function(e,t,n,r){if(r){var i=u.get(e)||{};i[n]=r,u.set(e,i),e.addEventListener(n,t)}}(t,e,r,e[n.value])}}))}))},mount:function(e=!1){this.connect&&s.store.subscribe(this.render,this.connect,this);var t=this.target;"string"==typeof t&&(t=document.querySelector(t)),this.el&&t===this.el||t&&t.parentNode&&(this.el=t,e?this.domHydrate():this.render())},hydrate:function(e){arguments.length>0&&e&&"object"==typeof e&&(this._data=e),this.mount(!0)},append:function(e){this.connect&&s.store.subscribe(this.render,this.connect,this),this.el||this.render(),e.appendChild(this.el)},unmount:function(){s.store.unsubscribe(this.render,this.connect),this.el.parentNode.removeChild(this.el)}}),s}));