!function(e){"object"==typeof module&&module.exports?module.exports=e():window.Pepper=e()}((function(){var e=Array.prototype;function t(t,n){return e.slice.call(t,n)}function n(t,n,r){return e.forEach.call(t,n,r)}function r(e){return t(arguments,1).forEach((function(t){Object.keys(t).forEach((function(n){e[n]=t[n]}))})),e}function i(e){e=e||{};for(var t=1;t<arguments.length;t+=1){var n=arguments[t];if(n&&"object"==typeof c)for(var r=Object.keys(n),o=1;o<r.length;o+=1){var a=r[o],c=n[a];e[a]="object"==typeof c&&null!==c?i(e[a],c):c}}return e}function o(e,t){if(e.nodeType!==t.nodeType||1===e.nodeType&&e.nodeName!==t.nodeName)return t.parentNode.replaceChild(e,t);if(1===e.nodeType){for(n(t.attributes,(function(n){e.attributes.getNamedItem(n.name)||t.attributes.removeNamedItem(n.name)})),n(e.attributes,(function(e){t.getAttribute(e.name)!==e.value&&t.setAttribute(e.name,e.value)}));t.childNodes.length>e.childNodes.length;)t.removeChild(t.lastChild);n(e.childNodes,(function(e,n){var r=t.childNodes[n];r?e!==r&&o(e,r):t.appendChild(e)}))}else 3!==e.nodeType&&8!==e.nodeType||t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue)}var a=function(e){this.id=a.generateUId(),this._data={};var t=e.data;t&&"object"==typeof t&&(this._data=t);var n=e.mount,i=e.hydrate;delete e.data,delete e.mount,delete e.hydrate,r(this,e),Object.defineProperty(this,"data",{configurable:!1,set:function(e){this._data=e,this.render()},get:function(){return this._data}}),i?this.hydrate():n&&this.mount()},c=new WeakMap;return r(a,{uid:1,utils:utils,generateUId:function(){var e="view-"+a.uid;return a.uid+=1,e},getHtml:function(){return""},store:{_data:{},subscribers:[],subscribe:function(e,t,n){"function"==typeof e&&Array.isArray(t)&&(this.subscribers.some((function(t){return t.callback===e&&(void 0===n||n===t.context)}))||this.subscribers.push({callback:e,props:t,context:n}))},unsubscribe:function(e,t){this.subscribers=this.subscribers.filter((function(n){return!(n.callback===e&&(void 0===t||t===n.context))}))},assign:function(e){if("object"==typeof e){var t=this._data,n=Object.keys(e).filter((function(n){return t[n]!==e[n]}));r(this._data,e),this.notify(n)}},notify:function(e){var t=e.reduce((function(e,t){return e[t]=1,e}),{});this.subscribers.forEach((function(e){e.props.some((function(e){return"string"==typeof e&&t[e]}))&&e.callback.call(e.context)}))}}}),Object.defineProperty(a.store,"data",{configurable:!1,set:function(e){if("object"==typeof e){var t=this._data,n=Object.keys(e).filter((function(n){return t[n]!==e[n]}));this._data=e,this.notify(n)}},get:function(){return this._data}}),r(a.prototype,{_data:null,target:null,connect:null,assign:function(){var e=t(arguments);r.apply(null,[this.data].concat(e)),this.render()},merge:function(e){i(this.data,e),this.render()},handleEvent:function(e){!function(e,t){var n=t.currentTarget,r=(c.get(n)||{})[t.type];r&&r.call(e,t)}(this,e)},render:function(){var e=this.el,n=document.activeElement.id;e&&[e].concat(t(e.querySelectorAll("*"))).forEach((function(e){1===e.nodeType&&function(e,t){Object.keys(c.get(e)||{}).forEach((function(n){e.removeEventListener(n,t)})),c.delete(e)}(e,this)}),this);var i=a.store._data,s=r((this.connect||[]).reduce((function(e,t){return e[t]=i[t],e}),{}),this.data),u=function(e){var t;if("content"in document.createElement("template")){var n=document.createElement("template");n.innerHTML=e,t=n.content}else window.jQuery?(t=document.createDocumentFragment(),jQuery.parseHTML(e).forEach((function(e){t.appendChild(e)}))):t=window.parseHTML(e);for(var r=t.querySelectorAll("script"),i=0;i<r.length;i+=1)t.removeChild(r[i]);return t}(this.getHtml(s)).firstElementChild;if(e){var d=e.parentNode,l=t(d.childNodes).indexOf(e);o(u,e),this.el=d.childNodes[l]}else this.el=u;if(n){var f=document.getElementById(n);f&&f.focus()}this.domHydrate()},domHydrate:function(){var e=this;e.el.pepperInstance=e,n(e.el.querySelectorAll("[ref]"),(function(t){e[t.getAttribute("ref")]=t}));var r=t(e.el.querySelectorAll("[refs]"));r.forEach((function(t){e[t.getAttribute("ref")]=[]})),r.forEach((function(t){e[t.getAttribute("ref")].push(t)})),[e.el].concat(t(e.el.querySelectorAll("*"))).forEach((function(t){1===t.nodeType&&n(t.attributes,(function(n){if(n.name.startsWith("on-")){var r=n.name.replace(/on-/,"");!function(e,t,n,r){if(r){var i=c.get(e)||{};i[n]=r,c.set(e,i),e.addEventListener(n,t)}}(t,e,r,e[n.value])}}))}))},mount:function(e=!1){this.connect&&a.store.subscribe(this.render,this.connect,this);var t=this.target;"string"==typeof t&&(t=document.querySelector(t)),this.el&&t===this.el||t&&t.parentNode&&(this.el=t,e?this.domHydrate():this.render())},hydrate:function(e){arguments.length>0&&e&&"object"==typeof e&&(this._data=e),this.mount(!0)},append:function(e){this.connect&&a.store.subscribe(this.render,this.connect,this),this.el||this.render(),e.appendChild(this.el)},unmount:function(){a.store.unsubscribe(this.render,this.connect),this.el.parentNode.removeChild(this.el)}}),a}));