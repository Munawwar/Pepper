!function(e){"object"==typeof module&&module.exports?module.exports=e():window.Pepper=e()}((function(){var e=Array.prototype;function t(t,n){return e.slice.call(t,n)}function n(t,n,r){return e.forEach.call(t,n,r)}function r(e){return Object.keys(e).filter((function(e){return"constructor"!==e}))}function o(e){return t(arguments,1).forEach((function(t){r(t).forEach((function(n){e[n]=t[n]}))})),e}function i(e){e=e||{};for(var t=1;t<arguments.length;t+=1){var n=arguments[t];if(n&&"object"==typeof c)for(var r=r(n),o=1;o<r.length;o+=1){var a=r[o],c=n[a];e[a]="object"==typeof c&&null!==c?i(e[a],c):c}}return e}function a(e){if(e.tagName.indexOf("-")>0)return!0;var t=e.getAttribute("is");return t&&t.indexOf("-")>0}function c(e,t){for(var n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),r=n.currentNode;r;)a(r)?r=n.nextSibling():(t(r),r=n.nextNode())}function u(e,t){var n,r=t.get(e);return r||(r=e.nodeType+":"+(1===e.nodeType?a(e)?(n=e).outerHTML.slice(0,-(n.innerHTML.length+n.tagName.length+4))+"/>":e.outerHTML:e.nodeValue),t.set(e,r)),r}function f(e,r,o,i){if(e.length){var c=new WeakMap,d={};e.forEach((function(e){var t=u(e,c);d[t]=d[t]||{u:[],n2l:new Map,l2n:new Map},d[t].u.push(e)}));var l=0,s={};if(r.forEach((function(e){var t=u(e,c),n=d[t],r=!1;if(n){var o=n.u.shift();o&&(n.n2l.set(o,e),n.l2n.set(e,o),r=!0,l++)}r||1!==e.nodeType||(s[e.nodeName]=s[e.nodeName]||[],s[e.nodeName].push(e))})),l===e.length&&r.length>e.length)for(var h=r.length-1;h>=0;h--){var v=r[h],p=u(v,c);d[p]&&d[p].l2n.has(v)||(o.removeChild(v),r.splice(h,1))}var m=t(o.childNodes).indexOf(i)+1,g=new Set;e.forEach((function(e,r){var i=u(e,c),l=d[i].n2l.get(e),h=o.childNodes[m+r];if(l)return g.add(l),void(h!==l&&o.insertBefore(l,h));var v=e.nodeName;if(1!==e.nodeType||!s[v]||!s[v].length)return g.add(e),void o.insertBefore(e,h);var p=e,b=s[e.nodeName].shift();g.add(b),h!==b&&o.insertBefore(b,h),function(e,t){n(t.attributes,(function(n){e.attributes.getNamedItem(n.name)||t.attributes.removeNamedItem(n.name)})),n(e.attributes,(function(e){t.getAttribute(e.name)!==e.value&&t.setAttribute(e.name,e.value)}))}(p,b),a(p)||f(t(p.childNodes),t(b.childNodes),b)})),r.forEach((function(e){g.has(e)||o.removeChild(e)}))}else r.forEach((e=>o.removeChild(e)))}var d=function(e){var t=this;t._data="object"==typeof e.data&&e.data||{};var n=e.mount,r=e.hydrate;delete e.data,delete e.mount,delete e.hydrate,o(t,e),Object.defineProperty(t,"data",{configurable:!1,set:function(e){t._data=e,t.render()},get:function(){return t._data}}),r?t.hydrate():n&&t.mount()},l=new WeakMap;return d.store=function(){var e={},t=[];function n(e){var n=e.reduce((function(e,t){return e[t]=1,e}),{});t.forEach((function(e){var t=e.props.filter((function(e){return n[e]}));t.length&&e.callback.call(e.context,t)}))}var i={subscribe:function(e,n,r){"function"==typeof n&&Array.isArray(e)&&(t.some((function(e){return e.callback===n&&(void 0===r||r===e.context)}))||t.push({props:e,callback:n,context:r}))},unsubscribe:function(e,n){t=t.filter((function(t){return!(t.callback===e&&(void 0===n||n===t.context))}))},assign:function(t){if("object"==typeof t){var i=r(t).filter((function(n){return e[n]!==t[n]}));o(e,t),n(i)}}};return Object.defineProperty(i,"data",{configurable:!1,set:function(t){if("object"==typeof t){var o=[].concat(r(t).filter((function(t){return e[t]!==data[t]})),r(e).filter((function(e){return!(e in t)})));e=t,n(o)}},get:function(){return e}}),i}(),o(d.prototype,{_data:null,target:null,connect:null,getHtml:function(){return""},assign:function(){var e=t(arguments);o.apply(null,[this.data].concat(e)),this.render()},merge:function(e){i(this.data,e),this.render()},handleEvent:function(e){!function(e,t){var n=t.currentTarget,r=(l.get(n)||{})[t.type];r&&r.call(e,t)}(this,e)},render:function(){var e=this,n=e.el,r=document.activeElement.id;n&&c(n,(function(t){var n=t.getAttribute("ref");n&&e[n]instanceof Node&&delete e[n],l.has(t)&&function(e,t){Object.keys(l.get(e)||{}).forEach((function(n){e.removeEventListener(n,t)})),l.delete(e)}(t,e)}));var i=d.store._data,a=o((e.connect||[]).reduce((function(e,t){return e[t]=i[t],e}),{}),e.data),u=function(e){var t;if("content"in document.createElement("template")){var n=document.createElement("template");n.innerHTML=e,t=n.content}else window.jQuery?(t=document.createDocumentFragment(),jQuery.parseHTML(e).forEach((function(e){t.appendChild(e)}))):t=window.parseHTML(e);for(var r=t.querySelectorAll("script"),o=0;o<r.length;o+=1)t.removeChild(r[o]);return t}(e.getHtml(a)).firstElementChild;if(n){var s=n.parentNode,h=t(s.childNodes).indexOf(n);f([u],[n],s,n.previousSibling),e.el=s.childNodes[h]}else e.el=u;if(r){var v=document.getElementById(r);v&&v.focus()}e.domHydrate()},domHydrate:function(){var e=this;e.el.pepperInstance=e,c(e.el,(function(t){var r=t.getAttribute("ref");r&&(e[r]=t),n(t.attributes,(function(n){if(n.name.startsWith("on-")){var r=n.name.replace(/on-/,"");!function(e,t,n,r){if(r){var o=l.get(e)||{};o[n]=r,l.set(e,o),e.addEventListener(n,t)}}(t,e,r,e[n.value])}}))}))},mount:function(e=!1){this.connect&&d.store.subscribe(this.connect,this.render,this);var t=this.target;"string"==typeof t&&(t=document.querySelector(t)),this.el&&t===this.el||t&&t.parentNode&&(this.el=t,e?this.domHydrate():this.render())},hydrate:function(e){arguments.length>0&&e&&"object"==typeof e&&(this._data=e),this.mount(!0)},append:function(e){this.connect&&d.store.subscribe(this.connect,this.render,this),this.el||this.render(),e.appendChild(this.el)},unmount:function(){d.store.unsubscribe(this.render,this),this.el.parentNode.removeChild(this.el)}}),d}));